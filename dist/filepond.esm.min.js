/*
 * FilePond 3.1.3
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
const isNode=e=>e instanceof HTMLElement,createStore=(e,t=[],r=[])=>{const o=Object.assign({},e),i=[],n=[],a=(e,t,r)=>{r?n.push({type:e,data:t}):(p[e]&&p[e](t),i.push({type:e,data:t}))},s=(e,...t)=>c[e]?c[e](...t):null,l={getState:()=>Object.assign({},o),processActionQueue:()=>{const e=[...i];return i.length=0,e},processDispatchQueue:()=>{const e=[...n];n.length=0,e.forEach(({type:e,data:t})=>{a(e,t)})},dispatch:a,query:s};let c={};t.forEach(e=>{c=Object.assign({},e(o),c)});let p={};return r.forEach(e=>{p=Object.assign({},e(a,s,o),p)}),l},defineProperty=(e,t,r)=>{"function"!=typeof r?Object.defineProperty(e,t,Object.assign({},r)):e[t]=r},forin=(e,t)=>{for(const r in e)e.hasOwnProperty(r)&&t(r,e[r])},createObject=e=>{const t={};return forin(e,r=>{defineProperty(t,r,e[r])}),t},attr=(e,t,r=null)=>{if(null===r)return e.getAttribute(t)||e.hasAttribute(t);e.setAttribute(t,r)},ns="http://www.w3.org/2000/svg",svgElements=["svg","path"],isSVGElement=e=>svgElements.includes(e),createElement=(e,t,r={})=>{"object"==typeof t&&(r=t,t=null);const o=isSVGElement(e)?document.createElementNS(ns,e):document.createElement(e);return t&&(isSVGElement(e)?attr(o,"class",t):o.className=t),forin(r,(e,t)=>{attr(o,e,t)}),o},appendChild=e=>(t,r)=>{void 0!==r&&e.children[r]?e.insertBefore(t,e.children[r]):e.appendChild(t)},appendChildView=(e,t)=>(e,r)=>(void 0!==r?t.splice(r,0,e):t.push(e),e),removeChildView=(e,t)=>r=>(t.splice(t.indexOf(r),1),r.element.parentNode&&e.removeChild(r.element),r),getViewRect=(e,t,r,o)=>{const i=r[0]||e.left,n=r[1]||e.top,a=i+e.width,s=n+e.height*(o[1]||1),l={element:Object.assign({},e),inner:{left:e.left,top:e.top,right:e.right,bottom:e.bottom},outer:{left:i,top:n,right:a,bottom:s}};return t.filter(e=>!e.isRectIgnored()).map(e=>e.rect).forEach(e=>{expandRect(l.inner,Object.assign({},e.inner)),expandRect(l.outer,Object.assign({},e.outer))}),calculateRectSize(l.inner),l.outer.bottom+=l.element.marginBottom,l.outer.right+=l.element.marginRight,calculateRectSize(l.outer),l},expandRect=(e,t)=>{t.top+=e.top,t.right+=e.left,t.bottom+=e.top,t.left+=e.left,t.bottom>e.bottom&&(e.bottom=t.bottom),t.right>e.right&&(e.right=t.right)},calculateRectSize=e=>{e.width=e.right-e.left,e.height=e.bottom-e.top},isNumber=e=>"number"==typeof e,thereYet=(e,t,r,o=.001)=>Math.abs(e-t)<o&&Math.abs(r)<o,spring=({stiffness:e=.5,damping:t=.75,mass:r=10}={})=>{let o=null,i=null,n=0,a=!1;const s=createObject({interpolate:()=>{if(a)return;if(!isNumber(o)||!isNumber(i))return a=!0,void(n=0);thereYet(i+=n+=-(i-o)*e/r,o,n*=t)?(i=o,n=0,a=!0,s.onupdate(i),s.oncomplete(i)):s.onupdate(i)},target:{set:e=>{if(isNumber(e)&&!isNumber(i)&&(i=e),null===o&&(o=e,i=e),o=e,i===o||void 0===o)return a=!0,n=0,s.onupdate(i),void s.oncomplete(i);a=!1},get:()=>o},resting:{get:()=>a},onupdate:e=>{},oncomplete:e=>{}});return s},easeInOutQuad=e=>e<.5?2*e*e:(4-2*e)*e-1,tween=({duration:e=500,easing:t=easeInOutQuad,delay:r=0}={})=>{let o,i,n=null,a=!0,s=!1,l=null;const c=createObject({interpolate:p=>{a||null===l||(null===n&&(n=p),p-n<r||((o=p-n-r)<e?(i=o/e,c.onupdate((o>=0?t(s?1-i:i):0)*l)):(o=1,i=s?0:1,c.onupdate(i*l),c.oncomplete(i*l),a=!0)))},target:{get:()=>s?0:l,set:e=>{if(null===l)return l=e,c.onupdate(e),void c.oncomplete(e);e<l?(l=1,s=!0):(s=!1,l=e),a=!1,n=null}},resting:{get:()=>a},onupdate:e=>{},oncomplete:e=>{}});return c},animator={spring:spring,tween:tween},createAnimator=(e,t,r)=>{const o=e[t]&&"object"==typeof e[t][r]?e[t][r]:e[t]||e,i="string"==typeof o?o:o.type,n="object"==typeof o?Object.assign({},o):{};return animator[i]?animator[i](n):null},addGetSet=(e,t,r,o=!1)=>{(t=Array.isArray(t)?t:[t]).forEach(t=>{e.forEach(e=>{let i=e,n=()=>r[e],a=t=>r[e]=t;"object"==typeof e&&(i=e.key,n=e.getter||n,a=e.setter||a),t[i]&&!o||(t[i]={get:n,set:a})})})},isDefined=e=>null!=e,animations=({mixinConfig:e,viewProps:t,viewInternalAPI:r,viewExternalAPI:o,viewState:i})=>{const n=Object.assign({},t),a=[];return forin(e,(e,i)=>{const s=createAnimator(i);if(!s)return;s.onupdate=(r=>{t[e]=r}),s.target=n[e];addGetSet([{key:e,setter:e=>{s.target!==e&&(s.target=e)},getter:()=>t[e]}],[r,o],t,!0),a.push(s)}),{write:e=>{let t=!0;return a.forEach(r=>{r.resting||(t=!1),r.interpolate(e)}),t},destroy:()=>{}}},addEvent=e=>(t,r)=>{e.addEventListener(t,r)},removeEvent=e=>(t,r)=>{e.removeEventListener(t,r)},listeners=({mixinConfig:e,viewProps:t,viewInternalAPI:r,viewExternalAPI:o,viewState:i,view:n})=>{const a=[],s=addEvent(n.element),l=removeEvent(n.element);return o.on=((e,t)=>{a.push({type:e,fn:t}),s(e,t)}),o.off=((e,t)=>{a.splice(a.findIndex(r=>r.type===e&&r.fn===t),1),l(e,t)}),{write:()=>!0,destroy:()=>{a.forEach(e=>{l(e.type,e.fn)})}}},apis=({mixinConfig:e,viewProps:t,viewExternalAPI:r})=>{addGetSet(e,r,t)},defaults={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},styles=({mixinConfig:e,viewProps:t,viewInternalAPI:r,viewExternalAPI:o,view:i})=>{const n=Object.assign({},t),a={};addGetSet(e,[r,o],t);const s=()=>i.rect?getViewRect(i.rect,i.childViews,[t.translateX||0,t.translateY||0],[t.scaleX||0,t.scaleY||0]):null;return r.rect={get:s},o.rect={get:s},e.forEach(e=>{t[e]=void 0===n[e]?defaults[e]:n[e]}),{write:()=>{if(propsHaveChanged(a,t))return applyStyles(i.element,t),Object.assign(a,Object.assign({},t)),!0},destroy:()=>{}}},propsHaveChanged=(e,t)=>{if(Object.keys(e).length!==Object.keys(t).length)return!0;for(const r in t)if(t[r]!==e[r])return!0;return!1},applyStyles=(e,{opacity:t,perspective:r,translateX:o,translateY:i,scaleX:n,scaleY:a,rotateX:s,rotateY:l,rotateZ:c,originX:p,originY:d,width:u,height:m})=>{let E="",g="";(isDefined(p)||isDefined(d))&&(g+=`transform-origin: ${p||0}px ${d||0}px;`),isDefined(r)&&(E+=`perspective(${r}px) `),(isDefined(o)||isDefined(i))&&(E+=`translate3d(${o||0}px, ${i||0}px, 0) `),(isDefined(n)||isDefined(a))&&(E+=`scale3d(${isDefined(n)?n:1}, ${isDefined(a)?a:1}, 1) `),isDefined(c)&&(E+=`rotateZ(${c}rad) `),isDefined(s)&&(E+=`rotateX(${s}rad) `),isDefined(l)&&(E+=`rotateY(${l}rad) `),E.length&&(g+=`transform:${E};`),isDefined(t)&&(g+=`opacity:${t};`,0===t&&(g+="visibility:hidden;"),t<1&&(g+="pointer-events:none;")),isDefined(m)&&(g+=`height:${m}px;`),isDefined(u)&&(g+=`width:${u}px;`);const f=e.elementCurrentStyle||"";g.length===f.length&&g===f||(e.setAttribute("style",g),e.elementCurrentStyle=g)},Mixins={styles:styles,listeners:listeners,animations:animations,apis:apis},updateRect=(e={},t={},r={})=>(t.layoutCalculated||(e.paddingTop=parseInt(r.paddingTop,10)||0,e.marginTop=parseInt(r.marginTop,10)||0,e.marginRight=parseInt(r.marginRight,10)||0,e.marginBottom=parseInt(r.marginBottom,10)||0,e.marginLeft=parseInt(r.marginLeft,10)||0,t.layoutCalculated=!0),e.left=t.offsetLeft||0,e.top=t.offsetTop||0,e.width=t.offsetWidth||0,e.height=t.offsetHeight||0,e.right=e.left+e.width,e.bottom=e.top+e.height,e.scrollTop=t.scrollTop,e.hidden=null===t.offsetParent,e),createView=({tag:e="div",name:t=null,attributes:r={},read:o=(()=>{}),write:i=(()=>{}),create:n=(()=>{}),destroy:a=(()=>{}),filterFrameActionsForChild:s=((e,t)=>t),didCreateView:l=(()=>{}),ignoreRect:c=!1,ignoreRectUpdate:p=!1,mixins:d=[]}={})=>(u,m={})=>{const E=createElement(e,`filepond--${t}`,r),g=window.getComputedStyle(E,null),f=updateRect();let I=null,T=!1;const _=[],y=[],R={},O={},h=[i],S=[o],D=[a],b=()=>E,P=()=>[..._],A=()=>I||(I=getViewRect(f,_,[0,0],[1,1])),v={element:{get:b},style:{get:()=>g},childViews:{get:P}},L=Object.assign({},v,{rect:{get:A},ref:{get:()=>R},is:e=>t===e,appendChild:appendChild(E),createChildView:(e=>(t,r)=>t(e,r))(u),linkView:e=>(_.push(e),e),unlinkView:e=>{_.splice(_.indexOf(e),1)},appendChildView:appendChildView(0,_),removeChildView:removeChildView(E,_),registerWriter:e=>h.push(e),registerReader:e=>S.push(e),registerDestroyer:e=>D.push(e),invalidateLayout:()=>E.layoutCalculated=!1,dispatch:u.dispatch,query:u.query}),w={element:{get:b},childViews:{get:P},rect:{get:A},resting:{get:()=>T},isRectIgnored:()=>c,_read:()=>{I=null,_.forEach(e=>e._read());!(p&&f.width&&f.height)&&updateRect(f,E,g);const e={root:C,props:m,rect:f};S.forEach(t=>t(e))},_write:(e,t=[])=>{let r=0===t.length;return h.forEach(o=>{!1===o({props:m,root:C,actions:t,timestamp:e})&&(r=!1)}),y.forEach(t=>{!1===t.write(e)&&(r=!1)}),_.filter(e=>!!e.element.parentNode).forEach(o=>{o._write(e,s(o,t))||(r=!1)}),_.forEach((o,i)=>{o.element.parentNode||(C.appendChild(o.element,i),o._read(),o._write(e,s(o,t)),r=!1)}),T=r,r},_destroy:()=>{y.forEach(e=>e.destroy()),D.forEach(e=>{e({root:C,props:m})}),_.forEach(e=>e._destroy())}},M=Object.assign({},v,{rect:{get:()=>f}});Object.keys(d).sort((e,t)=>"styles"===e?1:"styles"===t?-1:0).forEach(e=>{const t=Mixins[e]({mixinConfig:d[e],viewProps:m,viewState:O,viewInternalAPI:L,viewExternalAPI:w,view:createObject(M)});t&&y.push(t)});const C=createObject(L);n({root:C,props:m});const N=E.children.length;return _.forEach((e,t)=>{C.appendChild(e.element,N+t)}),l(C),createObject(w)},createPainter=(e,t=60)=>{const r=1e3/t;let o=null,i=null;const n=t=>{i=window.requestAnimationFrame(n),o||(o=t);const a=t-o;a<=r||(o=t-a%r,e(t))};return n(performance.now()),{pause:()=>{window.cancelAnimationFrame(i)}}},createUpdater=(e,t,r)=>o=>{e.forEach(e=>e[t]()),e.forEach(e=>e[r](o))},createRoute=(e,t)=>({root:r,props:o,actions:i=[]})=>{i.filter(t=>e[t.type]).forEach(t=>e[t.type]({root:r,props:o,action:t.data})),t&&t({root:r,props:o,actions:i})},insertBefore=(e,t)=>t.parentNode.insertBefore(e,t),insertAfter=(e,t)=>t.parentNode.insertBefore(e,t.nextSibling),isArray=e=>Array.isArray(e),isEmpty=e=>null==e,trim=e=>e.trim(),toString=e=>""+e,toArray=(e,t=",")=>isEmpty(e)?[]:isArray(e)?e:toString(e).split(t).map(trim).filter(e=>e.length),isBoolean=e=>"boolean"==typeof e,toBoolean=e=>isBoolean(e)?e:"true"===e,isString=e=>"string"==typeof e,toNumber=e=>isNumber(e)?e:isString(e)?toString(e).replace(/[a-z]+/gi,""):0,toInt=e=>parseInt(toNumber(e),10),toFloat=e=>parseFloat(toNumber(e)),isInt=e=>isNumber(e)&&isFinite(e)&&Math.floor(e)===e,toBytes=e=>{if(isInt(e))return e;let t=toString(e).trim();return/MB$/i.test(t)?(t=t.replace(/MB$i/,"").trim(),1e3*toInt(t)*1e3):/KB/i.test(t)?(t=t.replace(/KB$i/,"").trim(),1e3*toInt(t)):toInt(t)},isFunction=e=>"function"==typeof e,toFunctionReference=e=>{let t=self,r=e.split("."),o=null;for(;o=r.shift();)if(!(t=t[o]))return null;return t},methods={process:"POST",revert:"DELETE",fetch:"GET",restore:"GET",load:"GET"},createServerAPI=e=>{const t={};return t.url=isString(e)?e:e.url||"",t.timeout=e.timeout?parseInt(e.timeout,10):0,forin(methods,r=>{t[r]=createAction(r,e[r],methods[r],t.timeout)}),t},createAction=(e,t,r,o)=>{if(null===t)return null;if("function"==typeof t)return t;const i={url:"GET"===r?`?${e}=`:"",method:r,headers:{},withCredentials:!1,timeout:o,onload:null,onerror:null};if(isString(t))return i.url=t,i;if(Object.assign(i,t),isString(i.headers)){const e=i.headers.split(/:(.+)/);i.headers={header:e[0],value:e[1]}}return i.withCredentials=toBoolean(i.withCredentials),i},toServerAPI=e=>createServerAPI(e),isNull=e=>null===e,isObject=e=>"object"==typeof e&&null!==e,isAPI=e=>isObject(e)&&isString(e.url)&&isObject(e.process)&&isObject(e.revert)&&isObject(e.restore)&&isObject(e.fetch),getType=e=>isArray(e)?"array":isNull(e)?"null":isInt(e)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(e)?"bytes":isAPI(e)?"api":typeof e,replaceSingleQuotes=e=>e.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",'),conversionTable={array:toArray,boolean:toBoolean,int:e=>"bytes"===getType(e)?toBytes(e):toInt(e),float:toFloat,bytes:toBytes,string:e=>isFunction(e)?e:toString(e),serverapi:toServerAPI,object:e=>{try{return JSON.parse(replaceSingleQuotes(e))}catch(e){return null}},function:e=>toFunctionReference(e)},convertTo=(e,t)=>conversionTable[t](e),getValueByType=(e,t,r)=>{if(e===t)return e;let o=getType(e);if(o!==r){const t=convertTo(e,r);if(o=getType(t),null===t)throw`Trying to assign value with incorrect type to "${option}", allowed type: "${r}"`;e=t}return e},createOption=(e,t)=>{let r=e;return{enumerable:!0,get:()=>r,set:o=>{r=getValueByType(o,e,t)}}},createOptions=e=>{const t={};return forin(e,r=>{const o=e[r];t[r]=createOption(o[0],o[1])}),createObject(t)},createInitialState=e=>({items:[],options:createOptions(e)}),fromCamels=(e,t="-")=>e.split(/(?=[A-Z])/).map(e=>e.toLowerCase()).join(t),createOptionAPI=(e,t)=>{const r={};return forin(t,t=>{r[t]={get:()=>e.getState().options[t],set:r=>{e.dispatch(`SET_${fromCamels(t,"_").toUpperCase()}`,{value:r})}}}),r},createOptionActions=e=>(t,r,o)=>{const i={};return forin(e,e=>{const r=fromCamels(e,"_").toUpperCase();i[`SET_${r}`]=(i=>{try{o.options[e]=i.value}catch(e){}t(`DID_SET_${r}`,{value:o.options[e]})})}),i},createOptionQueries=e=>t=>{const r={};return forin(e,e=>{r[`GET_${fromCamels(e,"_").toUpperCase()}`]=(r=>t.options[e])}),r},InteractionMethod={API:1,DROP:2,BROWSE:3,PASTE:4,NONE:5},getUniqueId=()=>Math.random().toString(36).substr(2,9),forEachDelayed=(e,t,r=75)=>e.map((e,o)=>new Promise((i,n)=>{setTimeout(()=>{t(e),i()},r*o)})),arrayRemove=(e,t)=>e.splice(t,1),on=()=>{const e=[],t=(t,r)=>{arrayRemove(e,e.findIndex(e=>e.event===t&&(e.cb===r||!r)))};return{fire:(t,...r)=>{e.filter(e=>e.event===t).map(e=>e.cb).forEach(e=>{setTimeout(()=>{e(...r)},0)})},on:(t,r)=>{e.push({event:t,cb:r})},onOnce:(r,o)=>{e.push({event:r,cb:(...e)=>{t(r,o),o(...e)}})},off:t}},copyObjectPropertiesToObject=(e,t,r)=>{Object.getOwnPropertyNames(e).filter(e=>!r.includes(e)).forEach(r=>Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r)))},PRIVATE_METHODS=["fire","process","revert","load","on","off","onOnce","retryLoad","extend","archive","release","requestProcessing"],createItemAPI=e=>{const t={};return copyObjectPropertiesToObject(e,t,PRIVATE_METHODS),t},nextTick=e=>{setTimeout(e,16)},removeReleasedItems=e=>{e.forEach((t,r)=>{t.released&&arrayRemove(e,r)})},getNonNumeric=e=>/[^0-9]+/.exec(e),getDecimalSeparator=()=>getNonNumeric(1.1.toLocaleString())[0],getThousandsSeparator=()=>{const e=getDecimalSeparator(),t=1e3.toLocaleString();return t!==1e3.toString()?getNonNumeric(t)[0]:"."===e?",":"."},Type={BOOLEAN:"boolean",INT:"int",STRING:"string",ARRAY:"array",OBJECT:"object",FUNCTION:"function",ACTION:"action",SERVER_API:"serverapi",REGEX:"regex"},filters=[],applyFilterChain=(e,t,r)=>new Promise((o,i)=>{const n=filters.filter(t=>t.key===e).map(e=>e.cb);if(0===n.length)return void o(t);const a=n.shift();n.reduce((e,t)=>e.then(e=>t(e,r)),a(t,r)).then(e=>o(e)).catch(e=>i(e))}),applyFilters=(e,t,r)=>filters.filter(t=>t.key===e).map(e=>e.cb(t,r)),addFilter=(e,t)=>filters.push({key:e,cb:t}),extendDefaultOptions=e=>Object.assign(defaultOptions,e),getOptions$1=()=>Object.assign({},defaultOptions),setOptions$1=e=>{forin(e,(e,t)=>{defaultOptions[e]&&(defaultOptions[e][0]=getValueByType(t,defaultOptions[e][0],defaultOptions[e][1]))})},defaultOptions={id:[null,Type.STRING],name:["filepond",Type.STRING],className:[null,Type.STRING],required:[!1,Type.BOOLEAN],captureMethod:[null,Type.STRING],allowDrop:[!0,Type.BOOLEAN],allowBrowse:[!0,Type.BOOLEAN],allowPaste:[!0,Type.BOOLEAN],allowMultiple:[!1,Type.BOOLEAN],allowReplace:[!0,Type.BOOLEAN],allowRevert:[!0,Type.BOOLEAN],maxFiles:[null,Type.INT],dropOnPage:[!1,Type.BOOLEAN],dropOnElement:[!0,Type.BOOLEAN],dropValidation:[!1,Type.BOOLEAN],ignoredFiles:[[".ds_store","thumbs.db","desktop.ini"],Type.ARRAY],instantUpload:[!0,Type.BOOLEAN],server:[null,Type.SERVER_API],labelDecimalSeparator:[getDecimalSeparator(),Type.STRING],labelThousandsSeparator:[getThousandsSeparator(),Type.STRING],labelIdle:['Drag & Drop your files or <span class="filepond--label-action">Browse</span>',Type.STRING],labelFileWaitingForSize:["Waiting for size",Type.STRING],labelFileSizeNotAvailable:["Size not available",Type.STRING],labelFileCountSingular:["file in list",Type.STRING],labelFileCountPlural:["files in list",Type.STRING],labelFileLoading:["Loading",Type.STRING],labelFileAdded:["Added",Type.STRING],labelFileRemoved:["Removed",Type.STRING],labelFileLoadError:["Error during load",Type.STRING],labelFileProcessing:["Uploading",Type.STRING],labelFileProcessingComplete:["Upload complete",Type.STRING],labelFileProcessingAborted:["Upload cancelled",Type.STRING],labelFileProcessingError:["Error during upload",Type.STRING],labelTapToCancel:["tap to cancel",Type.STRING],labelTapToRetry:["tap to retry",Type.STRING],labelTapToUndo:["tap to undo",Type.STRING],labelButtonRemoveItem:["Remove",Type.STRING],labelButtonAbortItemLoad:["Abort",Type.STRING],labelButtonRetryItemLoad:["Retry",Type.STRING],labelButtonAbortItemProcessing:["Cancel",Type.STRING],labelButtonUndoItemProcessing:["Undo",Type.STRING],labelButtonRetryItemProcessing:["Retry",Type.STRING],labelButtonProcessItem:["Upload",Type.STRING],iconRemove:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M11.586 13l-2.293 2.293a1 1 0 0 0 1.414 1.414L13 14.414l2.293 2.293a1 1 0 0 0 1.414-1.414L14.414 13l2.293-2.293a1 1 0 0 0-1.414-1.414L13 11.586l-2.293-2.293a1 1 0 0 0-1.414 1.414L11.586 13z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconProcess:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M14 10.414v3.585a1 1 0 0 1-2 0v-3.585l-1.293 1.293a1 1 0 0 1-1.414-1.415l3-3a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1-1.414 1.415L14 10.414zM9 18a1 1 0 0 1 0-2h8a1 1 0 0 1 0 2H9z" fill="currentColor" fill-rule="evenodd"/></svg>',Type.STRING],iconRetry:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M10.81 9.185l-.038.02A4.997 4.997 0 0 0 8 13.683a5 5 0 0 0 5 5 5 5 0 0 0 5-5 1 1 0 0 1 2 0A7 7 0 1 1 9.722 7.496l-.842-.21a.999.999 0 1 1 .484-1.94l3.23.806c.535.133.86.675.73 1.21l-.804 3.233a.997.997 0 0 1-1.21.73.997.997 0 0 1-.73-1.21l.23-.928v-.002z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconUndo:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M9.185 10.81l.02-.038A4.997 4.997 0 0 1 13.683 8a5 5 0 0 1 5 5 5 5 0 0 1-5 5 1 1 0 0 0 0 2A7 7 0 1 0 7.496 9.722l-.21-.842a.999.999 0 1 0-1.94.484l.806 3.23c.133.535.675.86 1.21.73l3.233-.803a.997.997 0 0 0 .73-1.21.997.997 0 0 0-1.21-.73l-.928.23-.002-.001z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],iconDone:['<svg width="26" height="26" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><path d="M18.293 9.293a1 1 0 0 1 1.414 1.414l-7.002 7a1 1 0 0 1-1.414 0l-3.998-4a1 1 0 1 1 1.414-1.414L12 15.586l6.294-6.293z" fill="currentColor" fill-rule="nonzero"/></svg>',Type.STRING],oninit:[null,Type.FUNCTION],onwarning:[null,Type.FUNCTION],onerror:[null,Type.FUNCTION],onaddfilestart:[null,Type.FUNCTION],onaddfileprogress:[null,Type.FUNCTION],onaddfile:[null,Type.FUNCTION],onprocessfilestart:[null,Type.FUNCTION],onprocessfileprogress:[null,Type.FUNCTION],onprocessfileabort:[null,Type.FUNCTION],onprocessfilerevert:[null,Type.FUNCTION],onprocessfile:[null,Type.FUNCTION],onremovefile:[null,Type.FUNCTION],onpreparefile:[null,Type.FUNCTION],onupdatefiles:[null,Type.FUNCTION],beforeRemoveFile:[null,Type.FUNCTION],stylePanelLayout:[null,Type.STRING],stylePanelAspectRatio:[null,Type.STRING],styleButtonRemoveItemPosition:["left",Type.STRING],styleButtonProcessItemPosition:["right",Type.STRING],styleLoadIndicatorPosition:["right",Type.STRING],styleProgressIndicatorPosition:["right",Type.STRING],files:[[],Type.ARRAY]},getItemByQuery=(e,t)=>isEmpty(t)?e[0]||null:isInt(t)?e[t]||null:("object"==typeof t&&(t=t.id),e.find(e=>e.id===t)||null),getNumericAspectRatioFromString=e=>{if(isEmpty(e))return e;if(/:/.test(e)){const[t,r]=e.split(":");return r/t}return parseFloat(e)},getActiveItems=e=>e.filter(e=>!e.archived),queries=e=>({GET_ITEM:t=>getItemByQuery(e.items,t),GET_ACTIVE_ITEM:t=>getItemByQuery(getActiveItems(e.items),t),GET_ACTIVE_ITEMS:t=>getActiveItems(e.items),GET_ITEMS:t=>e.items,GET_ITEM_NAME:t=>{const r=getItemByQuery(e.items,t);return r?r.filename:null},GET_ITEM_SIZE:t=>{const r=getItemByQuery(e.items,t);return r?r.fileSize:null},GET_STYLES:()=>Object.keys(e.options).filter(e=>/^style/.test(e)).map(t=>({name:t,value:e.options[t]})),GET_PANEL_ASPECT_RATIO:()=>{return/circle/.test(e.options.stylePanelLayout)?1:getNumericAspectRatioFromString(e.options.stylePanelAspectRatio)},GET_TOTAL_ITEMS:()=>getActiveItems(e.items).length,IS_ASYNC:()=>isObject(e.options.server)&&(isObject(e.options.server.process)||isFunction(e.options.server.process))}),hasRoomForItem=e=>{const t=getActiveItems(e.items).length;if(!e.options.allowMultiple)return 0===t;const r=e.options.maxFiles;return null===r||t<r},limit=(e,t,r)=>Math.max(Math.min(r,e),t),arrayInsert=(e,t,r)=>e.splice(t,0,r),insertItem=(e,t,r)=>isEmpty(t)?null:void 0===r?(e.push(t),t):(r=limit(r,0,e.length),arrayInsert(e,r,t),t),isBase64DataURI=e=>/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*)\s*$/i.test(e),getFilenameFromURL=e=>e.split("/").pop().split("?").shift(),getExtensionFromFilename=e=>e.split(".").pop(),guesstimateExtension=e=>{if("string"!=typeof e)return"";const t=e.split("/").pop();return/svg/.test(t)?"svg":/zip|compressed/.test(t)?"zip":/plain/.test(t)?"txt":/msword/.test(t)?"doc":/[a-z]+/.test(t)?"jpeg"===t?"jpg":t:""},leftPad=(e,t="")=>(t+e).slice(-t.length),getDateString=(e=new Date)=>`${e.getFullYear()}-${leftPad(e.getMonth()+1,"00")}-${leftPad(e.getDate(),"00")}_${leftPad(e.getHours(),"00")}-${leftPad(e.getMinutes(),"00")}-${leftPad(e.getSeconds(),"00")}`,getFileFromBlob=(e,t,r=null,o=null)=>{const i="string"==typeof r?e.slice(0,e.size,r):e.slice(0,e.size,e.type);return i.lastModifiedDate=new Date,isString(t)||(t=getDateString()),t&&null===o&&getExtensionFromFilename(t)?i.name=t:(o=o||guesstimateExtension(i.type),i.name=t+(o?"."+o:"")),i},getBlobBuilder=()=>window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,createBlob=(e,t)=>{const r=getBlobBuilder();if(r){const o=new r;return o.append(e),o.getBlob(t)}return new Blob([e],{type:t})},getBlobFromByteStringWithMimeType=(e,t)=>{const r=new ArrayBuffer(e.length),o=new Uint8Array(r);for(let t=0;t<e.length;t++)o[t]=e.charCodeAt(t);return createBlob(r,t)},getMimeTypeFromBase64DataURI=e=>(/^data:(.+);/.exec(e)||[])[1]||null,getBase64DataFromBase64DataURI=e=>{return e.split(",")[1].replace(/\s/g,"")},getByteStringFromBase64DataURI=e=>atob(getBase64DataFromBase64DataURI(e)),getBlobFromBase64DataURI=e=>{const t=getMimeTypeFromBase64DataURI(e),r=getByteStringFromBase64DataURI(e);return getBlobFromByteStringWithMimeType(r,t)},getFileFromBase64DataURI=(e,t,r)=>getFileFromBlob(getBlobFromBase64DataURI(e),t,null,r),getFilenameFromHeaders=e=>{const t=e.split("\n");for(const e of t){const t=e.match(/filename="(.+)"/);if(t&&t[1])return t[1]}return null},createFileLoader=e=>{const t={source:null,complete:!1,progress:0,size:null,timestamp:null,duration:0,request:null},r=r=>{e?(t.timestamp=Date.now(),t.request=e(r,e=>{t.duration=Date.now()-t.timestamp,t.complete=!0,e instanceof Blob&&(e=getFileFromBlob(e,getFilenameFromURL(r))),o.fire("load",e instanceof Blob?e:e.body)},e=>{o.fire("error","string"==typeof e?{type:"error",code:0,body:e}:e)},(e,r,i)=>{i&&(t.size=i),t.duration=Date.now()-t.timestamp,e?(t.progress=r/i,o.fire("progress",t.progress)):t.progress=null},()=>{o.fire("abort")},e=>{o.fire("meta",{size:t.size,filename:getFilenameFromHeaders("string"==typeof e?e:e.headers)})})):o.fire("error",{type:"error",body:"Can't load URL",code:400})},o=Object.assign({},on(),{setSource:e=>t.source=e,getProgress:()=>t.progress,abort:()=>{t.request&&t.request.abort()},load:()=>{const e=t.source;o.fire("init",e),e instanceof File?o.fire("load",e):e instanceof Blob?o.fire("load",getFileFromBlob(e,e.name)):isBase64DataURI(e)?o.fire("load",getFileFromBase64DataURI(e)):r(e)}});return o},sendRequest=(e,t,r)=>{const o={onheaders:()=>{},onprogress:()=>{},onload:()=>{},ontimeout:()=>{},onerror:()=>{},onabort:()=>{},abort:()=>{i=!0,a.abort()}};let i=!1,n=!1;r=Object.assign({method:"POST",headers:{},withCredentials:!1},r),/GET/i.test(r.method)&&e&&(t=`${t}${encodeURIComponent("string"==typeof e?e:JSON.stringify(e))}`);const a=new XMLHttpRequest;return(/GET/i.test(r.method)?a:a.upload).onprogress=(e=>{i||o.onprogress(e.lengthComputable,e.loaded,e.total)}),a.onreadystatechange=(()=>{a.readyState<2||4===a.readyState&&0===a.status||n||(n=!0,o.onheaders(a))}),a.onload=(()=>{a.status>=200&&a.status<300?o.onload(a):o.onerror(a)}),a.onerror=(()=>o.onerror(a)),a.onabort=(()=>{i=!0,o.onabort()}),a.ontimeout=(()=>o.ontimeout(a)),a.open(r.method,t,!0),isInt(r.timeout)&&(a.timeout=r.timeout),Object.keys(r.headers).forEach(e=>{a.setRequestHeader(e,r.headers[e])}),r.responseType&&(a.responseType=r.responseType),r.withCredentials&&(a.withCredentials=!0),a.send(e),o},createResponse=(e,t,r,o)=>({type:e,code:t,body:r,headers:o}),createTimeoutResponse=e=>t=>{e(createResponse("error",0,"Timeout",t.getAllResponseHeaders()))},createFetchFunction=(e="",t)=>{if("function"==typeof t)return t;if(!t||!isString(t.url))return null;const r=t.onload||(e=>e),o=t.onerror||(e=>null);return(i,n,a,s,l,c)=>{const p=sendRequest(i,e+t.url,Object.assign({},t,{responseType:"blob"}));return p.onload=(e=>{const t=e.getAllResponseHeaders(),o=getFilenameFromHeaders(t)||getFilenameFromURL(i);n(createResponse("load",e.status,getFileFromBlob(r(e.response),o),t))}),p.onerror=(e=>{a(createResponse("error",e.status,o(e.response)||e.statusText,e.getAllResponseHeaders()))}),p.onheaders=(e=>{c(createResponse("headers",e.status,null,e.getAllResponseHeaders()))}),p.ontimeout=createTimeoutResponse(a),p.onprogress=s,p.onabort=l,p}},createProcessorFunction=(e="",t,r)=>"function"==typeof t?(...e)=>t(r,...e):t&&isString(t.url)?(o,i,n,a,s,l)=>{if(!o)return;var c=new FormData;c.append(r,o,o.name),isObject(i)&&c.append(r,JSON.stringify(i));const p=t.onload||(e=>e),d=t.onerror||(e=>null),u=sendRequest(c,e+t.url,t);return u.onload=(e=>{n(createResponse("load",e.status,p(e.response),e.getAllResponseHeaders()))}),u.onerror=(e=>{a(createResponse("error",e.status,d(e.response)||e.statusText,e.getAllResponseHeaders()))}),u.ontimeout=createTimeoutResponse(a),u.onprogress=s,u.onabort=l,u}:null,createRevertFunction=(e="",t)=>{if("function"==typeof t)return t;if(!t||!isString(t.url))return(e,t)=>t();const r=t.onload||(e=>e),o=t.onerror||(e=>null);return(i,n,a)=>{const s=sendRequest(i,e+t.url,t);return s.onload=(e=>{n(createResponse("load",e.status,r(e.response),e.getAllResponseHeaders()))}),s.onerror=(e=>{a(createResponse("error",e.status,o(e.response)||e.statusText,e.getAllResponseHeaders()))}),s.ontimeout=createTimeoutResponse(a),s}},getRandomNumber=(e=0,t=1)=>e+Math.random()*(t-e),createPerceivedPerformanceUpdater=(e,t=1e3,r=0,o=25,i=250)=>{let n=null;const a=Date.now(),s=()=>{let r=Date.now()-a,l=getRandomNumber(o,i);r+l>t&&(l=r+l-t);let c=r/t;c>=1?e(1):(e(c),n=setTimeout(s,l))};return s(),{clear:()=>{clearTimeout(n)}}},createFileProcessor=e=>{const t={complete:!1,perceivedProgress:0,perceivedPerformanceUpdater:null,progress:null,timestamp:null,perceivedDuration:0,duration:0,request:null,response:null},r=()=>{t.request&&(t.perceivedPerformanceUpdater.clear(),t.request.abort(),t.complete=!0,o.fire("abort",t.response?t.response.body:null))},o=Object.assign({},on(),{process:(r,i)=>{const n=()=>{0!==t.duration&&null!==t.progress&&o.fire("progress",o.getProgress())},a=()=>{t.complete=!0,o.fire("load-perceived",t.response.body)};o.fire("start"),t.timestamp=Date.now(),t.perceivedPerformanceUpdater=createPerceivedPerformanceUpdater(e=>{t.perceivedProgress=e,t.perceivedDuration=Date.now()-t.timestamp,n(),t.response&&1===t.perceivedProgress&&!t.complete&&a()},getRandomNumber(750,1500)),t.request=e(r,i,e=>{t.response=isObject(e)?e:{type:"load",code:200,body:`${e}`,headers:{}},t.duration=Date.now()-t.timestamp,t.progress=1,o.fire("load",t.response.body),1===t.perceivedProgress&&a()},e=>{t.perceivedPerformanceUpdater.clear(),o.fire("error",isObject(e)?e:{type:"error",code:0,body:`${e}`})},(e,r,o)=>{t.duration=Date.now()-t.timestamp,t.progress=e?r/o:null,n()},()=>{t.perceivedPerformanceUpdater.clear(),o.fire("abort")})},abort:r,getProgress:()=>t.progress?Math.min(t.progress,t.perceivedProgress):null,getDuration:()=>Math.min(t.duration,t.perceivedDuration),reset:()=>{r(),t.complete=!1,t.perceivedProgress=0,t.progress=0,t.timestamp=null,t.perceivedDuration=0,t.duration=0,t.request=null,t.response=null}});return o},getFilenameWithoutExtension=e=>e.substr(0,e.lastIndexOf("."))||e,ItemStatus={INIT:1,IDLE:2,PROCESSING:3,PROCESSING_PAUSED:4,PROCESSING_COMPLETE:5,PROCESSING_ERROR:6,LOADING:7,LOAD_ERROR:8},createFileStub=e=>{let t=[e.name,e.size,e.type];return e instanceof Blob||isBase64DataURI(e)?t[0]=e.name||getDateString():isBase64DataURI(e)?(t[1]=e.length,t[2]=getMimeTypeFromBase64DataURI(e)):isString(e)&&(t[0]=getFilenameFromURL(e),t[1]=0,t[2]="application/octet-stream"),{name:t[0],size:t[1],type:t[2]}},FileOrigin$1={INPUT:1,LIMBO:2,LOCAL:3},createItem=(e=null,t=null,r=null)=>{const o=getUniqueId(),i={archived:!1,released:!1,source:null,file:r,serverFileReference:t,status:t?ItemStatus.PROCESSING_COMPLETE:ItemStatus.INIT,activeLoader:null,activeProcessor:null};let n=null;const a={},s=e=>i.status=e,l=(e,...t)=>{i.released||d.fire(e,...t)},c=(e,t)=>{if(n=null,!(i.file instanceof Blob))return void d.on("load",()=>{c(e,t)});e.on("load",e=>{i.serverFileReference=e}),e.on("load-perceived",e=>{i.activeProcessor=null,i.serverFileReference=e,s(ItemStatus.PROCESSING_COMPLETE),l("process-complete",e)}),e.on("start",()=>{l("process-start")}),e.on("error",e=>{i.activeProcessor=null,s(ItemStatus.PROCESSING_ERROR),l("process-error",e)}),e.on("abort",e=>{i.activeProcessor=null,i.serverFileReference=e,s(ItemStatus.IDLE),l("process-abort"),n&&n()}),e.on("progress",e=>{s(ItemStatus.PROCESSING),l("process-progress",e)});t(i.file,t=>{e.process(t,Object.assign({},a))},e=>{}),i.activeProcessor=e},p=(e,t)=>{const r=e.split("."),o=r[0],i=r.pop();let n=a;r.forEach(e=>n=n[e]),JSON.stringify(n[i])!==JSON.stringify(t)&&(n[i]=t,l("metadata-update",{key:o,value:a[o]}))},d=Object.assign({id:{get:()=>o},origin:{get:()=>e},serverId:{get:()=>i.serverFileReference},status:{get:()=>i.status},filename:{get:()=>i.file.name},filenameWithoutExtension:{get:()=>getFilenameWithoutExtension(i.file.name)},fileExtension:{get:()=>getExtensionFromFilename(i.file.name)},fileType:{get:()=>i.file.type},fileSize:{get:()=>i.file.size},file:{get:()=>i.file},source:{get:()=>i.source},getMetadata:e=>e?a[e]:Object.assign({},a),setMetadata:(e,t)=>{if(isObject(e)&&!t){const t=e;return Object.keys(t).forEach(e=>{p(e,t[e])}),e}return p(e,t),t},extend:(e,t)=>u[e]=t,abortLoad:()=>{i.activeLoader&&i.activeLoader.abort()},retryLoad:()=>{i.activeLoader&&i.activeLoader.load()},requestProcessing:()=>{s(ItemStatus.PROCESSING)},abortProcessing:()=>new Promise(e=>{i.activeProcessor?(n=(()=>{e()}),i.activeProcessor.abort()):e()}),load:(t,r,o)=>{i.source=t,i.file?l("load-skip"):(i.file=createFileStub(t),r.on("init",()=>{l("load-init")}),r.on("meta",e=>{i.file.size=e.size,i.file.filename=e.filename,l("load-meta")}),r.on("progress",e=>{s(ItemStatus.LOADING),l("load-progress",e)}),r.on("error",e=>{s(ItemStatus.LOAD_ERROR),l("load-request-error",e)}),r.on("abort",()=>{s(ItemStatus.INIT),l("load-abort")}),r.on("load",t=>{i.activeLoader=null;const r=t=>{i.file=t,s(e===FileOrigin$1.LIMBO&&i.serverFileReference?ItemStatus.PROCESSING_COMPLETE:ItemStatus.IDLE),l("load")};i.serverFileReference?r(t):o(t,r,e=>{i.file=t,l("load-meta"),s(ItemStatus.LOAD_ERROR),l("load-file-error",e)})}),r.setSource(t),i.activeLoader=r,r.load())},process:c,revert:e=>new Promise(t=>{null!==i.serverFileReference?(e(i.serverFileReference,()=>{i.serverFileReference=null,t()},e=>{t()}),s(ItemStatus.IDLE),l("process-revert")):t()})},on(),{release:()=>i.released=!0,released:{get:()=>i.released},archive:()=>i.archived=!0,archived:{get:()=>i.archived}}),u=createObject(d);return u},getItemIndexByQuery=(e,t)=>isEmpty(t)?0:isString(t)?e.findIndex(e=>e.id===t):-1,getItemById=(e,t)=>{const r=getItemIndexByQuery(e,t);if(!(r<0))return e[r]||null},fetchLocal=(e,t,r,o,i,n)=>{const a=sendRequest(null,e,{method:"GET",responseType:"blob"});return a.onload=(r=>{const o=r.getAllResponseHeaders(),i=getFilenameFromHeaders(o)||getFilenameFromURL(e);t(createResponse("load",r.status,getFileFromBlob(r.response,i),o))}),a.onerror=(e=>{r(createResponse("error",e.status,e.statusText,e.getAllResponseHeaders()))}),a.onheaders=(e=>{n(createResponse("headers",e.status,null,e.getAllResponseHeaders()))}),a.ontimeout=createTimeoutResponse(r),a.onprogress=o,a.onabort=i,a},getDomainFromURL=e=>(0===e.indexOf("//")&&(e=location.protocol+e),e.toLowerCase().replace("blob:","").replace(/([a-z])?:\/\//,"$1").split("/")[0]),isExternalURL=e=>(e.indexOf(":")>-1||e.indexOf("//")>-1)&&getDomainFromURL(location.href)!==getDomainFromURL(e),isFile=e=>e instanceof File||e instanceof Blob&&e.name,dynamicLabel=e=>(...t)=>isFunction(e)?e(...t):e,isMockItem=e=>!isFile(e.file),getItemByQueryFromState=(e,t)=>({query:r,success:o=(()=>{}),failure:i=(()=>{})}={})=>{const n=getItemByQuery(e.items,r);n?t(n,o,i):i({error:createResponse("error",0,"Item not found"),file:null})},actions=(e,t,r)=>({ABORT_ALL:()=>{getActiveItems(r.items).forEach(e=>{e.abortLoad(),e.abortProcessing()})},DID_SET_FILES:({value:t=[]})=>{const o=t.map(e=>({source:e.source?e.source:e,options:e.options}));let i=getActiveItems(r.items);i.forEach(t=>{o.find(e=>e.source===t.source||e.source===t.file)||e("REMOVE_ITEM",{query:t})}),i=getActiveItems(r.items),o.forEach((t,r)=>{i.find(e=>e.source===t.source||e.file===t.source)||e("ADD_ITEM",Object.assign({},t,{interactionMethod:InteractionMethod.NONE,index:r}))})},DID_UPDATE_ITEM_METADATA:({id:o,change:i})=>{const n=getItemById(r.items,o);if(!t("IS_ASYNC"))return void applyFilterChain("SHOULD_PREPARE_OUTPUT",!1,{item:n,query:t}).then(t=>{t||retun,e("REQUEST_PREPARE_OUTPUT",{query:o,item:n,ready:t=>{e("DID_PREPARE_OUTPUT",{id:o,file:t})}},!0)});const a=()=>{e("REQUEST_ITEM_PROCESSING",{query:o})};return n.status===ItemStatus.PROCESSING_COMPLETE?(e=>{n.revert(createRevertFunction(r.options.server.url,r.options.server.revert)).then(e?a:()=>{})})(r.options.instantUpload):n.status===ItemStatus.PROCESSING?(e=>{n.abortProcessing().then(e?a:()=>{})})(r.options.instantUpload):void(r.options.instantUpload&&a())},ADD_ITEM:({source:o,index:i,interactionMethod:n,success:a=(()=>{}),failure:s=(()=>{}),options:l={}})=>{if(isEmpty(o))return void s({error:createResponse("error",0,"No source"),file:null});if(isFile(o)&&r.options.ignoredFiles.includes(o.name.toLowerCase()))return;if(!hasRoomForItem(r)){if(r.options.allowMultiple||!r.options.allowMultiple&&!r.options.allowReplace){const t=createResponse("warning",0,"Max files");return e("DID_THROW_MAX_FILES",{source:o,error:t}),void s({error:t,file:null})}const t=getActiveItems(r.items)[0];t.status===ItemStatus.PROCESSING_COMPLETE&&t.revert(createRevertFunction(r.options.server.url,r.options.server.revert)),e("REMOVE_ITEM",{query:t.id})}const c="local"===l.type?FileOrigin$1.LOCAL:"limbo"===l.type?FileOrigin$1.LIMBO:FileOrigin$1.INPUT,p=createItem(c,c===FileOrigin$1.INPUT?null:o,l.file);Object.keys(l.metadata||{}).forEach(e=>{p.setMetadata(e,l.metadata[e])}),applyFilters("DID_CREATE_ITEM",p,{query:t}),insertItem(r.items,p,i);const d=p.id;p.on("load-init",()=>{e("DID_START_ITEM_LOAD",{id:d})}),p.on("load-meta",()=>{e("DID_UPDATE_ITEM_META",{id:d})}),p.on("load-progress",t=>{e("DID_UPDATE_ITEM_LOAD_PROGRESS",{id:d,progress:t})}),p.on("load-request-error",t=>{const o=dynamicLabel(r.options.labelFileLoadError)(t);if(t.code>=400&&t.code<500)return e("DID_THROW_ITEM_INVALID",{id:d,error:t,status:{main:o,sub:`${t.code} (${t.body})`}}),void s({error:t,file:createItemAPI(p)});e("DID_THROW_ITEM_LOAD_ERROR",{id:d,error:t,status:{main:o,sub:r.options.labelTapToRetry}})}),p.on("load-file-error",t=>{e("DID_THROW_ITEM_INVALID",Object.assign({},t,{id:d}))}),p.on("load-abort",()=>{e("REMOVE_ITEM",{query:d})}),p.on("load-skip",()=>{e("COMPLETE_LOAD_ITEM",{query:d,item:p,data:{source:o,success:a}})}),p.on("load",()=>{applyFilterChain("DID_LOAD_ITEM",p,{query:t,dispatch:e}).then(()=>{p.on("metadata-update",t=>{e("DID_UPDATE_ITEM_METADATA",{id:d,change:t})}),applyFilterChain("SHOULD_PREPARE_OUTPUT",!1,{item:p,query:t}).then(t=>{const r=()=>{e("COMPLETE_LOAD_ITEM",{query:d,item:p,data:{source:o,success:a}})};t?e("REQUEST_PREPARE_OUTPUT",{query:d,item:p,ready:t=>{e("DID_PREPARE_OUTPUT",{id:d,file:t}),r()}},!0):r()})}).catch(()=>{e("REMOVE_ITEM",{query:d})})}),p.on("process-start",()=>{e("DID_START_ITEM_PROCESSING",{id:d})}),p.on("process-progress",t=>{e("DID_UPDATE_ITEM_PROCESS_PROGRESS",{id:d,progress:t})}),p.on("process-error",t=>{e("DID_THROW_ITEM_PROCESSING_ERROR",{id:d,error:t,status:{main:dynamicLabel(r.options.labelFileProcessingError)(t),sub:r.options.labelTapToRetry}})}),p.on("process-complete",t=>{e("DID_COMPLETE_ITEM_PROCESSING",{id:d,error:null,serverFileReference:t})}),p.on("process-abort",()=>{e("DID_ABORT_ITEM_PROCESSING",{id:d})}),p.on("process-revert",()=>{e("DID_REVERT_ITEM_PROCESSING",{id:d})}),e("DID_ADD_ITEM",{id:d,index:i,interactionMethod:n}),e("DID_UPDATE_ITEMS",{items:getActiveItems(r.items)});const{url:u,load:m,restore:E,fetch:g}=r.options.server||{};p.load(o,createFileLoader(c===FileOrigin$1.INPUT?isString(o)&&isExternalURL(o)?createFetchFunction(u,g):fetchLocal:c===FileOrigin$1.LIMBO?createFetchFunction(u,E):createFetchFunction(u,m)),(e,r,o)=>{applyFilterChain("LOAD_FILE",e,{query:t}).then(r).catch(o)})},REQUEST_PREPARE_OUTPUT:({item:e,ready:r})=>{applyFilterChain("PREPARE_OUTPUT",e.file,{query:t,item:e}).then(o=>{applyFilterChain("COMPLETE_PREPARE_OUTPUT",o,{query:t,item:e}).then(e=>{r(e)})})},COMPLETE_LOAD_ITEM:({item:o,data:i})=>{const{success:n,source:a}=i;e("DID_LOAD_ITEM",{id:o.id,error:null,serverFileReference:o.origin===FileOrigin$1.INPUT?null:a}),n(createItemAPI(o)),o.origin!==FileOrigin$1.LOCAL?o.origin!==FileOrigin$1.LIMBO?t("IS_ASYNC")&&r.options.instantUpload&&e("REQUEST_ITEM_PROCESSING",{query:o.id}):e("DID_COMPLETE_ITEM_PROCESSING",{id:o.id,error:null,serverFileReference:a}):e("DID_LOAD_LOCAL_ITEM",{id:o.id})},RETRY_ITEM_LOAD:getItemByQueryFromState(r,e=>{e.retryLoad()}),REQUEST_ITEM_PROCESSING:getItemByQueryFromState(r,t=>{const r=t.id;t.requestProcessing(),e("DID_REQUEST_ITEM_PROCESSING",{id:r}),e("PROCESS_ITEM",{query:t},!0)}),PROCESS_ITEM:getItemByQueryFromState(r,(o,i,n)=>{o.onOnce("process-complete",()=>{i(createItemAPI(o))}),o.onOnce("process-error",e=>{n({error:e,file:createItemAPI(o)})}),o.process(createFileProcessor(createProcessorFunction(r.options.server.url,r.options.server.process,r.options.name)),(r,i,n)=>{applyFilterChain("PREPARE_OUTPUT",r,{query:t,item:o}).then(t=>{e("DID_PREPARE_OUTPUT",{id:o.id,file:t}),i(t)}).catch(n)})}),RETRY_ITEM_PROCESSING:getItemByQueryFromState(r,t=>{e("REQUEST_ITEM_PROCESSING",{query:t})}),REQUEST_REMOVE_ITEM:getItemByQueryFromState(r,r=>{const o=t=>{t&&e("REMOVE_ITEM",{query:r})},i=t("GET_BEFORE_REMOVE_FILE");if(!i)return o(!0);const n=i(createItemAPI(r));return null==n?o(!0):"boolean"==typeof n?o(n):void("function"==typeof n.then&&n.then(o))}),RELEASE_ITEM:getItemByQueryFromState(r,e=>{e.release()}),REMOVE_ITEM:getItemByQueryFromState(r,(t,o)=>{const i=t.id;getItemById(r.items,i).archive(),e("DID_REMOVE_ITEM",{id:i,item:t}),e("DID_UPDATE_ITEMS",{items:getActiveItems(r.items)}),o(createItemAPI(t))}),ABORT_ITEM_LOAD:getItemByQueryFromState(r,e=>{e.abortLoad()}),ABORT_ITEM_PROCESSING:getItemByQueryFromState(r,t=>{t.serverId?e("REVERT_ITEM_PROCESSING",{id:t.id}):t.abortProcessing().then(()=>{r.options.instantUpload&&e("REMOVE_ITEM",{query:t.id})})}),REVERT_ITEM_PROCESSING:getItemByQueryFromState(r,t=>{t.revert(createRevertFunction(r.options.server.url,r.options.server.revert)).then(()=>{(r.options.instantUpload||isMockItem(t))&&e("REMOVE_ITEM",{query:t.id})})}),SET_OPTIONS:({options:t})=>{forin(t,(t,r)=>{e(`SET_${fromCamels(t,"_").toUpperCase()}`,{value:r})})}}),formatFilename=e=>decodeURI(e),createElement$1=e=>document.createElement(e),text=(e,t)=>{let r=e.childNodes[0];r?t!==r.nodeValue&&(r.nodeValue=t):(r=document.createTextNode(t),e.appendChild(r))},polarToCartesian=(e,t,r,o)=>{const i=(o%360-90)*Math.PI/180;return{x:e+r*Math.cos(i),y:t+r*Math.sin(i)}},describeArc=(e,t,r,o,i,n)=>{const a=polarToCartesian(e,t,r,i),s=polarToCartesian(e,t,r,o);return["M",a.x,a.y,"A",r,r,0,n,0,s.x,s.y].join(" ")},percentageArc=(e,t,r,o,i)=>{let n=1;return i>o&&i-o<=.5&&(n=0),o>i&&o-i>=.5&&(n=0),describeArc(e,t,r,360*Math.min(.9999,o),360*Math.min(.9999,i),n)},create$7=({root:e,props:t})=>{t.spin=!1,t.progress=0,t.opacity=0;const r=createElement("svg");e.ref.path=createElement("path",{"stroke-width":2,"stroke-linecap":"round"}),r.appendChild(e.ref.path),e.ref.svg=r,e.appendChild(r)},write$5=({root:e,props:t})=>{if(0===t.opacity)return;const r=parseInt(attr(e.ref.path,"stroke-width"),10),o=.5*e.rect.element.width;let i=0,n=0;t.spin?(i=0,n=.5):(i=0,n=t.progress);const a=percentageArc(o,o,o-r,i,n);attr(e.ref.path,"d",a),attr(e.ref.path,"stroke-opacity",t.spin||t.progress>0?1:0)},progressIndicator=createView({tag:"div",name:"progress-indicator",ignoreRectUpdate:!0,ignoreRect:!0,create:create$7,write:write$5,mixins:{apis:["progress","spin"],styles:["opacity"],animations:{opacity:{type:"tween",duration:500},progress:{type:"spring",stiffness:.95,damping:.65,mass:10}}}}),create$8=({root:e,props:t})=>{e.element.title=t.label,e.element.innerHTML=t.icon||"",t.disabled=!1},write$6=({root:e,props:t})=>{0!==t.opacity||t.disabled?t.opacity>0&&t.disabled&&(t.disabled=!1,e.element.removeAttribute("disabled")):(t.disabled=!0,attr(e.element,"disabled","disabled"))},fileActionButton=createView({tag:"button",attributes:{type:"button"},ignoreRect:!0,ignoreRectUpdate:!0,name:"file-action-button",mixins:{apis:["label"],styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{scaleX:"spring",scaleY:"spring",translateX:"spring",translateY:"spring",opacity:{type:"tween",duration:250}},listeners:!0},create:create$8,write:write$6}),toNaturalFileSize=(e,t=".")=>(e=Math.round(Math.abs(e)))<1e3?`${e} bytes`:e<MB?`${Math.floor(e/KB)} KB`:e<GB?`${removeDecimalsWhenZero(e/MB,1,t)} MB`:`${removeDecimalsWhenZero(e/GB,2,t)} GB`,KB=1e3,MB=1e6,GB=1e9,removeDecimalsWhenZero=(e,t,r)=>e.toFixed(t).split(".").filter(e=>"0"!==e).join(r),create$9=({root:e,props:t})=>{const r=createElement$1("span");r.className="filepond--file-info-main",attr(r,"aria-hidden","true"),e.appendChild(r),e.ref.fileName=r;const o=createElement$1("span");o.className="filepond--file-info-sub",e.appendChild(o),e.ref.fileSize=o,text(o,e.query("GET_LABEL_FILE_WAITING_FOR_SIZE")),text(r,formatFilename(e.query("GET_ITEM_NAME",t.id)))},updateFile=({root:e,props:t})=>{text(e.ref.fileSize,toNaturalFileSize(e.query("GET_ITEM_SIZE",t.id))),text(e.ref.fileName,formatFilename(e.query("GET_ITEM_NAME",t.id)))},updateFileSizeOnError=({root:e,props:t})=>{isInt(e.query("GET_ITEM_SIZE",t.id))||text(e.ref.fileSize,e.query("GET_LABEL_FILE_SIZE_NOT_AVAILABLE"))},fileInfo=createView({name:"file-info",ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:updateFile,DID_UPDATE_ITEM_META:updateFile,DID_THROW_ITEM_LOAD_ERROR:updateFileSizeOnError,DID_THROW_ITEM_INVALID:updateFileSizeOnError}),didCreateView:e=>{applyFilters("CREATE_VIEW",Object.assign({},e,{view:e}))},create:create$9,mixins:{styles:["translateX","translateY"],animations:{translateX:"spring",translateY:"spring"}}}),toPercentage=e=>Math.round(100*e),create$10=({root:e,props:t})=>{const r=createElement$1("span");r.className="filepond--file-status-main",e.appendChild(r),e.ref.main=r;const o=createElement$1("span");o.className="filepond--file-status-sub",e.appendChild(o),e.ref.sub=o,didSetItemLoadProgress({root:e,action:{progress:null}})},didSetItemLoadProgress=({root:e,action:t})=>{const r=null===t.progress?e.query("GET_LABEL_FILE_LOADING"):`${e.query("GET_LABEL_FILE_LOADING")} ${toPercentage(t.progress)}%`;text(e.ref.main,r),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_CANCEL"))},didSetItemProcessProgress=({root:e,action:t})=>{const r=null===t.progress?e.query("GET_LABEL_FILE_PROCESSING"):`${e.query("GET_LABEL_FILE_PROCESSING")} ${toPercentage(t.progress)}%`;text(e.ref.main,r),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_CANCEL"))},didRequestItemProcessing=({root:e})=>{text(e.ref.main,e.query("GET_LABEL_FILE_PROCESSING")),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_CANCEL"))},didAbortItemProcessing=({root:e})=>{text(e.ref.main,e.query("GET_LABEL_FILE_PROCESSING_ABORTED")),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_RETRY"))},didCompleteItemProcessing$1=({root:e})=>{text(e.ref.main,e.query("GET_LABEL_FILE_PROCESSING_COMPLETE")),text(e.ref.sub,e.query("GET_LABEL_TAP_TO_UNDO"))},clear=({root:e})=>{text(e.ref.main,""),text(e.ref.sub,"")},error=({root:e,action:t})=>{text(e.ref.main,t.status.main),text(e.ref.sub,t.status.sub)},fileStatus=createView({name:"file-status",ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:clear,DID_REVERT_ITEM_PROCESSING:clear,DID_REQUEST_ITEM_PROCESSING:didRequestItemProcessing,DID_ABORT_ITEM_PROCESSING:didAbortItemProcessing,DID_COMPLETE_ITEM_PROCESSING:didCompleteItemProcessing$1,DID_UPDATE_ITEM_PROCESS_PROGRESS:didSetItemProcessProgress,DID_UPDATE_ITEM_LOAD_PROGRESS:didSetItemLoadProgress,DID_THROW_ITEM_LOAD_ERROR:error,DID_THROW_ITEM_INVALID:error,DID_THROW_ITEM_PROCESSING_ERROR:error}),didCreateView:e=>{applyFilters("CREATE_VIEW",Object.assign({},e,{view:e}))},create:create$10,mixins:{styles:["translateX","translateY","opacity"],animations:{opacity:{type:"tween",duration:250},translateX:"spring",translateY:"spring"}}}),Buttons={AbortItemLoad:{label:"GET_LABEL_BUTTON_ABORT_ITEM_LOAD",action:"ABORT_ITEM_LOAD",className:"filepond--action-abort-item-load",align:"LOAD_INDICATOR_POSITION"},RetryItemLoad:{label:"GET_LABEL_BUTTON_RETRY_ITEM_LOAD",action:"RETRY_ITEM_LOAD",icon:"GET_ICON_RETRY",className:"filepond--action-retry-item-load",align:"BUTTON_PROCESS_ITEM_POSITION"},RemoveItem:{label:"GET_LABEL_BUTTON_REMOVE_ITEM",action:"REQUEST_REMOVE_ITEM",icon:"GET_ICON_REMOVE",className:"filepond--action-remove-item",align:"BUTTON_REMOVE_ITEM_POSITION"},ProcessItem:{label:"GET_LABEL_BUTTON_PROCESS_ITEM",action:"REQUEST_ITEM_PROCESSING",icon:"GET_ICON_PROCESS",className:"filepond--action-process-item",align:"BUTTON_PROCESS_ITEM_POSITION"},AbortItemProcessing:{label:"GET_LABEL_BUTTON_ABORT_ITEM_PROCESSING",action:"ABORT_ITEM_PROCESSING",className:"filepond--action-abort-item-processing",align:"BUTTON_PROCESS_ITEM_POSITION"},RetryItemProcessing:{label:"GET_LABEL_BUTTON_RETRY_ITEM_PROCESSING",action:"RETRY_ITEM_PROCESSING",icon:"GET_ICON_RETRY",className:"filepond--action-retry-item-processing",align:"BUTTON_PROCESS_ITEM_POSITION"},RevertItemProcessing:{label:"GET_LABEL_BUTTON_UNDO_ITEM_PROCESSING",action:"REVERT_ITEM_PROCESSING",icon:"GET_ICON_UNDO",className:"filepond--action-revert-item-processing",align:"BUTTON_PROCESS_ITEM_POSITION"}},ButtonKeys=[];forin(Buttons,e=>{ButtonKeys.push(e)});const calculateFileInfoOffset=e=>e.ref.buttonRemoveItem.rect.element.width+e.ref.buttonRemoveItem.rect.element.left,calculateFileVerticalCenterOffset=e=>Math.floor(e.ref.buttonRemoveItem.rect.element.height/4),calculateFileHorizontalCenterOffset=e=>Math.floor(e.ref.buttonRemoveItem.rect.element.left/2),DefaultStyle={buttonAbortItemLoad:{opacity:0},buttonRetryItemLoad:{opacity:0},buttonRemoveItem:{opacity:0},buttonProcessItem:{opacity:0},buttonAbortItemProcessing:{opacity:0},buttonRetryItemProcessing:{opacity:0},buttonRevertItemProcessing:{opacity:0},loadProgressIndicator:{opacity:0},processProgressIndicator:{opacity:0},processingCompleteIndicator:{opacity:0,scaleX:.75,scaleY:.75},info:{translateX:0,translateY:0,opacity:0},status:{translateX:0,translateY:0,opacity:0}},IdleStyle={buttonRemoveItem:{opacity:1},buttonProcessItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset}},ProcessingStyle={buttonAbortItemProcessing:{opacity:1},processProgressIndicator:{opacity:1},status:{opacity:1}},StyleMap={DID_THROW_ITEM_INVALID:{buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset,opacity:1}},DID_START_ITEM_LOAD:{buttonAbortItemLoad:{opacity:1},loadProgressIndicator:{opacity:1},status:{opacity:1}},DID_THROW_ITEM_LOAD_ERROR:{buttonRetryItemLoad:{opacity:1},buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{opacity:1}},DID_LOAD_ITEM:IdleStyle,DID_LOAD_LOCAL_ITEM:{buttonRemoveItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{translateX:calculateFileInfoOffset}},DID_START_ITEM_PROCESSING:ProcessingStyle,DID_REQUEST_ITEM_PROCESSING:ProcessingStyle,DID_UPDATE_ITEM_PROCESS_PROGRESS:ProcessingStyle,DID_COMPLETE_ITEM_PROCESSING:{buttonRevertItemProcessing:{opacity:1},info:{opacity:1},status:{opacity:1}},DID_THROW_ITEM_PROCESSING_ERROR:{buttonRemoveItem:{opacity:1},buttonRetryItemProcessing:{opacity:1},status:{opacity:1},info:{translateX:calculateFileInfoOffset}},DID_ABORT_ITEM_PROCESSING:{buttonRemoveItem:{opacity:1},buttonProcessItem:{opacity:1},info:{translateX:calculateFileInfoOffset},status:{opacity:1}},DID_REVERT_ITEM_PROCESSING:IdleStyle},processingCompleteIndicatorView=createView({create:({root:e})=>{e.element.innerHTML=e.query("GET_ICON_DONE")},name:"processing-complete-indicator",ignoreRect:!0,mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:"spring",scaleY:"spring",opacity:{type:"tween",duration:250}}}}),create$6=({root:e,props:t})=>{const{id:r}=t,o=e.query("GET_ALLOW_REVERT"),i=e.query("GET_INSTANT_UPLOAD"),n=e.query("IS_ASYNC"),a=n?ButtonKeys.concat():ButtonKeys.filter(e=>!/Process/.test(e));if(n&&!o){a.splice(-1,1);const e=StyleMap.DID_COMPLETE_ITEM_PROCESSING;e.info.translateX=calculateFileHorizontalCenterOffset,e.info.translateY=calculateFileVerticalCenterOffset,e.status.translateY=calculateFileVerticalCenterOffset,e.processingCompleteIndicator={opacity:1,scaleX:1,scaleY:1}}i&&o&&(Buttons.RevertItemProcessing.label="GET_LABEL_BUTTON_REMOVE_ITEM",Buttons.RevertItemProcessing.icon="GET_ICON_REMOVE"),forin(Buttons,(t,o)=>{const i=e.createChildView(fileActionButton,{label:e.query(o.label),icon:e.query(o.icon),opacity:0});a.includes(t)&&e.appendChildView(i),i.element.dataset.align=e.query(`GET_STYLE_${o.align}`),i.element.classList.add(o.className),i.on("click",()=>{e.dispatch(o.action,{query:r})}),e.ref[`button${t}`]=i}),e.ref.info=e.appendChildView(e.createChildView(fileInfo,{id:r})),e.ref.status=e.appendChildView(e.createChildView(fileStatus,{id:r})),e.ref.processingCompleteIndicator=e.appendChildView(e.createChildView(processingCompleteIndicatorView)),e.ref.processingCompleteIndicator.element.dataset.align=e.query("GET_STYLE_BUTTON_PROCESS_ITEM_POSITION");const s=e.appendChildView(e.createChildView(progressIndicator,{opacity:0}));s.element.classList.add("filepond--load-indicator"),s.element.dataset.align=e.query("GET_STYLE_LOAD_INDICATOR_POSITION"),e.ref.loadProgressIndicator=s;const l=e.appendChildView(e.createChildView(progressIndicator,{opacity:0}));l.element.classList.add("filepond--process-indicator"),l.element.dataset.align=e.query("GET_STYLE_PROGRESS_INDICATOR_POSITION"),e.ref.processProgressIndicator=l},write$4=({root:e,actions:t,props:r})=>{route$3({root:e,actions:t,props:r});let o=[...t].filter(e=>/^DID_/.test(e.type)).reverse().find(e=>StyleMap[e.type]);if(!o||o&&o.type===e.ref.currentAction)return;e.ref.currentAction=o.type;const i=StyleMap[e.ref.currentAction];forin(DefaultStyle,(t,r)=>{const o=e.ref[t];forin(r,(r,n)=>{const a=i[t]&&void 0!==i[t][r]?i[t][r]:n;o[r]="function"==typeof a?a(e):a})})},route$3=createRoute({DID_SET_LABEL_BUTTON_ABORT_ITEM_PROCESSING:({root:e,action:t})=>{e.ref.buttonAbortItemProcessing.label=t.value},DID_SET_LABEL_BUTTON_ABORT_ITEM_LOAD:({root:e,action:t})=>{e.ref.buttonAbortItemLoad.label=t.value},DID_REQUEST_ITEM_PROCESSING:({root:e,action:t})=>{e.ref.processProgressIndicator.spin=!0,e.ref.processProgressIndicator.progress=0},DID_START_ITEM_LOAD:({root:e,action:t})=>{e.ref.loadProgressIndicator.spin=!0,e.ref.loadProgressIndicator.progress=0},DID_UPDATE_ITEM_LOAD_PROGRESS:({root:e,action:t})=>{e.ref.loadProgressIndicator.spin=!1,e.ref.loadProgressIndicator.progress=t.progress},DID_UPDATE_ITEM_PROCESS_PROGRESS:({root:e,action:t})=>{e.ref.processProgressIndicator.spin=!1,e.ref.processProgressIndicator.progress=t.progress}}),file=createView({create:create$6,write:write$4,didCreateView:e=>{applyFilters("CREATE_VIEW",Object.assign({},e,{view:e}))},name:"file"}),create$5=({root:e,props:t})=>{e.ref.fileName=createElement$1("legend"),e.appendChild(e.ref.fileName),e.ref.file=e.appendChildView(e.createChildView(file,{id:t.id}));const r=createElement$1("input");r.type="hidden",r.name=e.query("GET_NAME"),e.ref.data=r,e.appendChild(r)},didLoadItem=({root:e,action:t,props:r})=>{e.ref.data.value=t.serverFileReference,text(e.ref.fileName,formatFilename(e.query("GET_ITEM_NAME",r.id)))},didRemoveItem=({root:e,action:t})=>{e.ref.data.removeAttribute("value")},didCompleteItemProcessing=({root:e,action:t})=>{e.ref.data.value=t.serverFileReference},didRevertItemProcessing=({root:e,action:t})=>{e.ref.data.removeAttribute("value")},fileWrapper=createView({create:create$5,ignoreRect:!0,write:createRoute({DID_LOAD_ITEM:didLoadItem,DID_REMOVE_ITEM:didRemoveItem,DID_COMPLETE_ITEM_PROCESSING:didCompleteItemProcessing,DID_REVERT_ITEM_PROCESSING:didRevertItemProcessing}),didCreateView:e=>{applyFilters("CREATE_VIEW",Object.assign({},e,{view:e}))},tag:"fieldset",name:"file-wrapper"}),PANEL_SPRING_PROPS={type:"spring",damping:.6,mass:7},create$11=({root:e,props:t})=>{[{name:"top"},{name:"center",props:{translateY:null,scaleY:null},mixins:{animations:{scaleY:PANEL_SPRING_PROPS},styles:["translateY","scaleY"]}},{name:"bottom",props:{translateY:null},mixins:{animations:{translateY:PANEL_SPRING_PROPS},styles:["translateY"]}}].forEach(r=>{createSection(e,r,t.name)}),e.element.classList.add(`filepond--${t.name}`),e.ref.scalable=null},createSection=(e,t,r)=>{const o=createView({name:`panel-${t.name} filepond--${r}`,mixins:t.mixins,ignoreRectUpdate:!0}),i=e.createChildView(o,t.props);e.ref[t.name]=e.appendChildView(i)},write$7=({root:e,props:t})=>{if(null!==e.ref.scalable&&t.scalable===e.ref.scalable||(e.ref.scalable=!isBoolean(t.scalable)||t.scalable,e.element.dataset.scalable=e.ref.scalable),!t.height)return;const r=e.ref.top.rect.element,o=e.ref.bottom.rect.element,i=Math.max(r.height+o.height,t.height);e.ref.center.translateY=r.height,e.ref.center.scaleY=(i-r.height-o.height)/100,e.ref.bottom.translateY=i-o.height},panel=createView({name:"panel",write:write$7,create:create$11,ignoreRect:!0,mixins:{apis:["height","scalable"]}}),create$4=({root:e,props:t})=>{e.ref.controls=e.appendChildView(e.createChildView(fileWrapper,{id:t.id})),e.ref.panel=e.appendChildView(e.createChildView(panel,{name:"item-panel"})),e.ref.panel.height=0,t.markedForRemoval=!1},StateMap={DID_START_ITEM_LOAD:"busy",DID_UPDATE_ITEM_LOAD_PROGRESS:"loading",DID_THROW_ITEM_INVALID:"load-invalid",DID_THROW_ITEM_LOAD_ERROR:"load-error",DID_LOAD_ITEM:"idle",DID_START_ITEM_PROCESSING:"busy",DID_REQUEST_ITEM_PROCESSING:"busy",DID_UPDATE_ITEM_PROCESS_PROGRESS:"processing",DID_COMPLETE_ITEM_PROCESSING:"processing-complete",DID_THROW_ITEM_PROCESSING_ERROR:"processing-error",DID_ABORT_ITEM_PROCESSING:"cancelled",DID_REVERT_ITEM_PROCESSING:"idle"},write$3=({root:e,actions:t,props:r})=>{e.ref.panel.height=e.ref.controls.rect.inner.height;const o=e.query("GET_PANEL_ASPECT_RATIO"),i=e.query("GET_ALLOW_MULTIPLE");e.height=o&&!i?e.rect.element.width*o:e.ref.controls.rect.inner.height;let n=[...t].filter(e=>/^DID_/.test(e.type)).reverse().find(e=>StateMap[e.type]);!n||n&&n.type===r.currentState||(r.currentState=n.type,e.element.dataset.filepondItemState=StateMap[r.currentState]||"")},item=createView({create:create$4,write:write$3,destroy:({root:e,props:t})=>{e.dispatch("RELEASE_ITEM",{query:t.id})},tag:"li",name:"item",mixins:{apis:["id","markedForRemoval"],styles:["translateX","translateY","scaleX","scaleY","opacity","height"],animations:{scaleX:"spring",scaleY:"spring",translateX:"spring",translateY:"spring",opacity:{type:"tween",duration:150}}}}),create$3=({root:e,props:t})=>{attr(e.element,"role","list")},addItemView=({root:e,action:t})=>{const{id:r,index:o,interactionMethod:i}=t,n={opacity:0};i===InteractionMethod.NONE&&(n.translateY=null),i===InteractionMethod.DROP&&(n.scaleX=.8,n.scaleY=.8,n.translateY=null),i===InteractionMethod.BROWSE&&(n.translateY=-30),i===InteractionMethod.API&&(n.translateX=-100,n.translateY=null),e.appendChildView(e.createChildView(item,Object.assign({id:r},n)),o)},removeItemView=({root:e,action:t})=>{const{id:r}=t,o=e.childViews.find(e=>e.id===r);o&&(o.scaleX=.9,o.scaleY=.9,o.opacity=0,o.markedForRemoval=!0)},route$2=createRoute({DID_ADD_ITEM:addItemView,DID_REMOVE_ITEM:removeItemView}),dragTranslation=(e,t,r)=>e-1===t?r/6:e===t?r/2:e+1===t?-r/2:e+2===t?-r/6:0,easeOutCirc=e=>{const t=e-1;return Math.sqrt(1-t*t)},read=({root:e})=>{let t=0;e.childViews.filter(e=>e.rect.outer.height).forEach(e=>{const r=e.rect.element.height+e.rect.element.marginBottom;t+=e.markedForRemoval?r*easeOutCirc(e.opacity):r}),e.rect.outer.height=t,e.rect.outer.bottom=e.rect.outer.height},write$2=({root:e,props:t,actions:r})=>{route$2({root:e,props:t,actions:r});let o=!0,i=0;return e.childViews.filter(e=>e.rect.outer.height).forEach((e,r)=>{const o=e.rect;e.translateX=0,e.translateY=i+(t.dragIndex>-1?dragTranslation(r,t.dragIndex,10):0),e.markedForRemoval||(e.scaleX=1,e.scaleY=1,e.opacity=1);let n=o.element.height+o.element.marginTop+o.element.marginBottom;const a=e.markedForRemoval?n*e.opacity:n;i+=a}),e.childViews.filter(e=>e.markedForRemoval&&0===e.opacity).forEach(t=>{e.removeChildView(t),o=!1,t._destroy()}),o},filterSetItemActions=(e,t)=>t.filter(t=>!t.data||!t.data.id||e.id===t.data.id),list=createView({create:create$3,write:write$2,read:read,tag:"ul",name:"list",filterFrameActionsForChild:filterSetItemActions,mixins:{apis:["dragIndex"]}}),getItemIndexByPosition=(e,t)=>{let r=0;const o=e.childViews,i=o.length;for(;r<i;r++){const e=o[r].rect.outer,i=e.top+.5*e.height;if(t.top<i)return r}return i},create$2=({root:e,props:t})=>{e.ref.list=e.appendChildView(e.createChildView(list)),t.dragCoordinates=null,t.overflowing=!1},storeDragCoordinates=({root:e,props:t,action:r})=>{t.dragCoordinates={left:r.position.scopeLeft,top:r.position.scopeTop-e.rect.outer.top+e.rect.element.scrollTop}},clearDragCoordinates=({props:e})=>{e.dragCoordinates=null},route$1=createRoute({DID_DRAG:storeDragCoordinates,DID_END_DRAG:clearDragCoordinates}),write$1=({root:e,props:t,actions:r})=>{if(route$1({root:e,props:t,actions:r}),e.ref.list.dragIndex=t.dragCoordinates?getItemIndexByPosition(e.ref.list,t.dragCoordinates):-1,t.overflowing&&!t.overflow&&(t.overflowing=!1,e.element.dataset.state="",e.height=null),t.overflow){const r=Math.round(t.overflow);r!==e.height&&(t.overflowing=!0,e.element.dataset.state="overflow",e.height=r)}},listScroller=createView({create:create$2,write:write$1,name:"list-scroller",mixins:{apis:["overflow"],styles:["height","translateY"],animations:{translateY:"spring"}}}),attrToggle=(e,t,r,o="")=>{r?attr(e,t,o):e.removeAttribute(t)},resetFileInput=e=>{if(e&&""!==e.value){try{e.value=""}catch(e){}if(e.value){const t=createElement$1("form"),r=e.parentNode,o=e.nextSibling;t.appendChild(e),t.reset(),o?r.insertBefore(e,o):r.appendChild(e)}}},create$12=({root:e,props:t})=>{e.element.id=`filepond--browser-${t.id}`,attr(e.element,"aria-controls",`filepond--assistant-${t.id}`),attr(e.element,"aria-labelledby",`filepond--drop-label-${t.id}`),e.ref.handleChange=(r=>{if(!e.element.value)return;const o=[...e.element.files];setTimeout(()=>{t.onload(o),resetFileInput(e.element)},250)}),e.element.addEventListener("change",e.ref.handleChange)},setAcceptedFileTypes=({root:e,action:t})=>{attrToggle(e.element,"accept",!!t.value,t.value?t.value.join(","):"")},toggleAllowMultiple=({root:e,action:t})=>{attrToggle(e.element,"multiple",t.value)},toggleAllowBrowse$1=({root:e,action:t})=>{attrToggle(e.element,"disabled",!t.value)},toggleRequired=({root:e,action:t})=>{t.value?0===e.query("GET_TOTAL_ITEMS")&&attrToggle(e.element,"required",!0):attrToggle(e.element,"required",!1)},setCaptureMethod=({root:e,action:t})=>{attrToggle(e.element,"capture",!!t.value,!0===t.value?"":t.value)},updateRequiredStatus=({root:e,props:t})=>{e.query("GET_TOTAL_ITEMS")>0?attrToggle(e.element,"required",!1):e.query("GET_REQUIRED")&&attrToggle(e.element,"required",!0)},browser=createView({tag:"input",name:"browser",ignoreRect:!0,ignoreRectUpdate:!0,attributes:{type:"file"},create:create$12,destroy:({root:e})=>{e.element.removeEventListener("change",e.ref.handleChange)},write:createRoute({DID_ADD_ITEM:updateRequiredStatus,DID_REMOVE_ITEM:updateRequiredStatus,DID_SET_ALLOW_BROWSE:toggleAllowBrowse$1,DID_SET_ALLOW_MULTIPLE:toggleAllowMultiple,DID_SET_ACCEPTED_FILE_TYPES:setAcceptedFileTypes,DID_SET_CAPTURE_METHOD:setCaptureMethod,DID_SET_REQUIRED:toggleRequired})}),Key={ENTER:13,SPACE:32},create$13=({root:e,props:t})=>{const r=createElement$1("label");attr(r,"for",`filepond--browser-${t.id}`),attr(r,"id",`filepond--drop-label-${t.id}`),attr(r,"aria-hidden","true"),r.addEventListener("keydown",t=>{t.keyCode!==Key.ENTER&&t.keyCode!==Key.SPACE||(t.preventDefault(),e.ref.label.click())}),updateLabelValue(r,t.caption),e.appendChild(r),e.ref.label=r},updateLabelValue=(e,t)=>{e.innerHTML=t;const r=e.querySelector(".filepond--label-action");return r&&attr(r,"tabindex","0"),t},dropLabel=createView({name:"drop-label",ignoreRect:!0,create:create$13,write:createRoute({DID_SET_LABEL_IDLE:({root:e,action:t})=>{updateLabelValue(e.ref.label,t.value)}}),mixins:{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:150},translateX:"spring",translateY:"spring"}}}),blob=createView({name:"drip-blob",ignoreRect:!0,mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{scaleX:"spring",scaleY:"spring",translateX:"spring",translateY:"spring",opacity:{type:"tween",duration:250}}}}),addBlob=({root:e})=>{const t=.5*e.rect.element.width,r=.5*e.rect.element.height;e.ref.blob=e.appendChildView(e.createChildView(blob,{opacity:0,scaleX:2.5,scaleY:2.5,translateX:t,translateY:r}))},moveBlob=({root:e,action:t})=>{e.ref.blob?(e.ref.blob.translateX=t.position.scopeLeft,e.ref.blob.translateY=t.position.scopeTop,e.ref.blob.scaleX=1,e.ref.blob.scaleY=1,e.ref.blob.opacity=1):addBlob({root:e})},hideBlob=({root:e})=>{e.ref.blob&&(e.ref.blob.opacity=0)},explodeBlob=({root:e})=>{e.ref.blob&&(e.ref.blob.scaleX=2.5,e.ref.blob.scaleY=2.5,e.ref.blob.opacity=0)},write$8=({root:e,props:t,actions:r})=>{route$4({root:e,props:t,actions:r});const{blob:o}=e.ref;0===r.length&&o&&0===o.opacity&&(e.removeChildView(o),e.ref.blob=null)},route$4=createRoute({DID_DRAG:moveBlob,DID_DROP:explodeBlob,DID_END_DRAG:hideBlob}),drip=createView({ignoreRect:!0,ignoreRectUpdate:!0,name:"drip",write:write$8}),getRootNode=e=>"getRootNode"in e?e.getRootNode():document,requestDataTransferItems=e=>new Promise((t,r)=>{const o=getLinks(e);o.length?t(o):getFiles(e).then(t)}),getFiles=e=>new Promise((t,r)=>{const o=(e.items?[...e.items]:[]).filter(e=>isFileSystemItem(e)).map(e=>getFilesFromItem(e));o.length?Promise.all(o).then(e=>{const r=[];e.forEach(e=>{r.push(...e)}),t(r.filter(e=>e))}):t(e.files?[...e.files]:[])}),isFileSystemItem=e=>{if(isEntry(e)){const t=getAsEntry(e);if(t)return t.isFile||t.isDirectory}return"file"===e.kind},getFilesFromItem=e=>new Promise((t,r)=>{isDirectoryEntry(e)?getFilesInDirectory(getAsEntry(e)).then(t):t([e.getAsFile()])}),getFilesInDirectory=e=>new Promise((t,r)=>{const o=[];let i=0;const n=e=>{e.createReader().readEntries(e=>{e.forEach(e=>{e.isDirectory?n(e):(i++,e.file(e=>{o.push(e),i===o.length&&t(o)}))})})};n(e)}),isDirectoryEntry=e=>isEntry(e)&&(getAsEntry(e)||{}).isDirectory,isEntry=e=>"webkitGetAsEntry"in e,getAsEntry=e=>e.webkitGetAsEntry(),getLinks=e=>{let t=[];try{if((t=getLinksFromTransferMetaData(e)).length)return t;t=getLinksFromTransferURLData(e)}catch(e){}return t},getLinksFromTransferURLData=e=>{let t=e.getData("url");return"string"==typeof t&&t.length?[t]:[]},getLinksFromTransferMetaData=e=>{let t=e.getData("text/html");if("string"==typeof t&&t.length){const e=t.match(/src\s*=\s*"(.+?)"/);if(e)return[e[1]]}return[]},dragNDropObservers=[],eventPosition=e=>({pageLeft:e.pageX,pageTop:e.pageY,scopeLeft:e.offsetX||e.layerX,scopeTop:e.offsetY||e.layerY}),createDragNDropClient=(e,t,r)=>{const o=getDragNDropObserver(t),i={element:e,filterElement:r,state:null,ondrop:()=>{},onenter:()=>{},ondrag:()=>{},onexit:()=>{},onload:()=>{},allowdrop:()=>{}};return i.destroy=o.addListener(i),i},getDragNDropObserver=e=>{const t=dragNDropObservers.find(t=>t.element===e);if(t)return t;const r=createDragNDropObserver(e);return dragNDropObservers.push(r),r},createDragNDropObserver=e=>{const t=[],r={dragenter:dragenter,dragover:dragover,dragleave:dragleave,drop:drop},o={};forin(r,(r,i)=>{o[r]=i(e,t),e.addEventListener(r,o[r],!1)});const i={element:e,addListener:n=>(t.push(n),()=>{t.splice(t.indexOf(n),1),0===t.length&&(dragNDropObservers.splice(dragNDropObservers.indexOf(i),1),forin(r,t=>{e.removeEventListener(t,o[t],!1)}))})};return i},elementFromPoint=(e,t)=>("elementFromPoint"in e||(e=document),e.elementFromPoint(t.x,t.y)),isEventTarget=(e,t)=>{const r=getRootNode(t),o=elementFromPoint(r,{x:e.pageX-window.pageXOffset,y:e.pageY-window.pageYOffset});return o===t||t.contains(o)};let initialTarget=null;const setDropEffect=(e,t)=>{try{e.dropEffect=t}catch(e){}},dragenter=(e,t)=>e=>{e.preventDefault(),initialTarget=e.target,t.forEach(t=>{const{element:r,onenter:o}=t;isEventTarget(e,r)&&(t.state="enter",o(eventPosition(e)))})},dragover=(e,t)=>e=>{e.preventDefault();const r=e.dataTransfer;requestDataTransferItems(r).then(o=>{let i=!1;t.some(t=>{const{filterElement:n,element:a,onenter:s,onexit:l,ondrag:c,allowdrop:p}=t;setDropEffect(r,"copy");const d=p(o);if(d)if(isEventTarget(e,a)){if(i=!0,null===t.state)return t.state="enter",void s(eventPosition(e));if(t.state="over",n&&!d)return void setDropEffect(r,"none");c(eventPosition(e))}else n&&!i&&setDropEffect(r,"none"),t.state&&(t.state=null,l(eventPosition(e)));else setDropEffect(r,"none")})})},drop=(e,t)=>e=>{e.preventDefault();const r=e.dataTransfer;requestDataTransferItems(r).then(r=>{t.forEach(t=>{const{filterElement:o,element:i,ondrop:n,onexit:a,allowdrop:s}=t;t.state=null;s(r)?o&&!isEventTarget(e,i)||n(eventPosition(e),r):a(eventPosition(e))})})},dragleave=(e,t)=>e=>{initialTarget===e.target&&t.forEach(t=>{const{onexit:r}=t;t.state=null,r(eventPosition(e))})},createHopper=(e,t,r)=>{e.classList.add("filepond--hopper");const{catchesDropsOnPage:o,requiresDropOnElement:i}=r,n=createDragNDropClient(e,o?document.documentElement:e,i);let a="",s="";n.allowdrop=(e=>t(e)),n.ondrop=((e,r)=>{t(r)?(s="drag-drop",l.onload(r,e)):l.ondragend(e)}),n.ondrag=(e=>{l.ondrag(e)}),n.onenter=(e=>{s="drag-over",l.ondragstart(e)}),n.onexit=(e=>{s="drag-exit",l.ondragend(e)});const l={updateHopperState:()=>{a!==s&&(e.dataset.hopperState=s,a=s)},onload:()=>{},ondragstart:()=>{},ondrag:()=>{},ondragend:()=>{},destroy:()=>{n.destroy()}};return l};let listening=!1;const listeners$1=[],handlePaste=e=>{requestDataTransferItems(e.clipboardData).then(e=>{e.length&&listeners$1.forEach(t=>t(e))})},listen=e=>{listeners$1.includes(e)||(listeners$1.push(e),listening||(listening=!0,document.addEventListener("paste",handlePaste)))},unlisten=e=>{arrayRemove(listeners$1,listeners$1.indexOf(e)),0===listeners$1.length&&(document.removeEventListener("paste",handlePaste),listening=!1)},createPaster=()=>{const e=e=>{t.onload(e)},t={destroy:()=>{unlisten(e)},onload:()=>{}};return listen(e),t},debounce=(e,t=16,r=!0)=>{let o=Date.now(),i=null;return(...n)=>{clearTimeout(i);const a=Date.now()-o,s=()=>{o=Date.now(),e(...n)};a<t?r||(i=setTimeout(s,t-a)):s()}},create$14=({root:e,props:t})=>{e.element.id=`filepond--assistant-${t.id}`,attr(e.element,"role","status"),attr(e.element,"aria-live","polite"),attr(e.element,"aria-relevant","additions")};let addFilesNotificationTimeout=null,notificationClearTimeout=null;const filenames=[],assist=(e,t)=>{e.element.textContent=t},clear$1=e=>{e.element.textContent=""},listModified=(e,t,r)=>{const o=e.query("GET_TOTAL_ITEMS");assist(e,`${r} ${t}, ${o} ${1===o?e.query("GET_LABEL_FILE_COUNT_SINGULAR"):e.query("GET_LABEL_FILE_COUNT_PLURAL")}`),clearTimeout(notificationClearTimeout),notificationClearTimeout=setTimeout(()=>{clear$1(e)},1500)},isUsingFilePond=e=>e.element.parentNode.contains(document.activeElement),itemAdded=({root:e,action:t})=>{if(!isUsingFilePond(e))return;e.element.textContent="";const r=e.query("GET_ITEM",t.id);filenames.push(r.filename),clearTimeout(addFilesNotificationTimeout),addFilesNotificationTimeout=setTimeout(()=>{listModified(e,filenames.join(", "),e.query("GET_LABEL_FILE_ADDED")),filenames.length=0},750)},itemRemoved=({root:e,action:t})=>{if(!isUsingFilePond(e))return;const r=t.item;listModified(e,r.filename,e.query("GET_LABEL_FILE_REMOVED"))},itemProcessed=({root:e,action:t})=>{const r=e.query("GET_ITEM",t.id).filename,o=e.query("GET_LABEL_FILE_PROCESSING_COMPLETE");assist(e,`${r} ${o}`)},itemProcessedUndo=({root:e,action:t})=>{const r=e.query("GET_ITEM",t.id).filename,o=e.query("GET_LABEL_FILE_PROCESSING_ABORTED");assist(e,`${r} ${o}`)},itemError=({root:e,action:t})=>{const r=e.query("GET_ITEM",t.id).filename;assist(e,`${t.status.main} ${r} ${t.status.sub}`)},assistant=createView({create:create$14,ignoreRect:!0,ignoreRectUpdate:!0,write:createRoute({DID_LOAD_ITEM:itemAdded,DID_REMOVE_ITEM:itemRemoved,DID_COMPLETE_ITEM_PROCESSING:itemProcessed,DID_ABORT_ITEM_PROCESSING:itemProcessedUndo,DID_REVERT_ITEM_PROCESSING:itemProcessedUndo,DID_THROW_ITEM_LOAD_ERROR:itemError,DID_THROW_ITEM_INVALID:itemError,DID_THROW_ITEM_PROCESSING_ERROR:itemError}),tag:"span",name:"assistant"}),toCamels=(e,t="-")=>e.replace(new RegExp(`${t}.`,"g"),e=>e.charAt(1).toUpperCase()),MAX_FILES_LIMIT=1e6,create$1=({root:e,props:t})=>{const r=e.query("GET_ID");r&&(e.element.id=r);const o=e.query("GET_CLASS_NAME");o&&o.split(" ").forEach(t=>{e.element.classList.add(t)}),e.ref.label=e.appendChildView(e.createChildView(dropLabel,Object.assign({},t,{translateY:null,caption:e.query("GET_LABEL_IDLE")}))),e.ref.list=e.appendChildView(e.createChildView(listScroller,{translateY:null})),e.ref.panel=e.appendChildView(e.createChildView(panel,{name:"panel-root"})),e.ref.assistant=e.appendChildView(e.createChildView(assistant,Object.assign({},t))),e.ref.measure=createElement$1("div"),e.ref.measure.style.height="100%",e.element.appendChild(e.ref.measure),e.ref.bounds=null,e.query("GET_STYLES").filter(e=>!isEmpty(e.value)).map(({name:t,value:r})=>{e.element.dataset[t]=r})},write=({root:e,props:t,actions:r})=>{let o=e.ref.bounds;o||(o=e.ref.bounds=calculateRootBoundingBoxHeight(e),e.element.removeChild(e.ref.measure),e.ref.measure=null),route({root:e,props:t,actions:r}),r.filter(e=>/^DID_SET_STYLE_/.test(e.type)).filter(e=>!isEmpty(e.data.value)).map(({type:t,data:r})=>{const o=toCamels(t.substr(8).toLowerCase(),"_");e.element.dataset[o]=r.value,e.invalidateLayout()});const{hopper:i,label:n,list:a,panel:s}=e.ref;i&&i.updateHopperState();const l=e.query("GET_PANEL_ASPECT_RATIO"),c=e.query("GET_ALLOW_MULTIPLE"),p=e.query("GET_TOTAL_ITEMS"),d=c?e.query("GET_MAX_FILES")||1e6:1,u=p===d,m=r.find(e=>"DID_ADD_ITEM"===e.type);if(u&&m){const e=m.data.interactionMethod;n.opacity=0,c?n.translateY=-40:e===InteractionMethod.API?n.translateX=40:n.translateY=e===InteractionMethod.BROWSE?40:30}else u||(n.opacity=1,n.translateX=0,n.translateY=0);const E=calculateListItemMargin(e),g=calculateListHeight(e,d),f=n.rect.element.height,I=!c||u?0:f,T=u?a.rect.element.marginTop:0,_=0===p?0:a.rect.element.marginBottom,y=I+T+g.visual+_,R=I+T+g.bounds+_;if(a.translateY=Math.max(0,I-a.rect.element.marginTop)-E.top,l){const t=e.rect.element.width*l;s.scalable=!1,s.height=t;const r=t-I-(_-E.bottom)-(u?T:0);g.visual>r?a.overflow=r:a.overflow=null,e.height=t}else if(o.fixedHeight){s.scalable=!1;const e=o.fixedHeight-I-(_-E.bottom)-(u?T:0);g.visual>e?a.overflow=e:a.overflow=null}else if(o.cappedHeight){const t=y>=o.cappedHeight,r=Math.min(o.cappedHeight,y);s.scalable=!0,s.height=t?r:r-E.top-E.bottom;const i=r-I-(_-E.bottom)-(u?T:0);y>o.cappedHeight&&g.visual>i?a.overflow=i:a.overflow=null,e.height=Math.min(o.cappedHeight,R-E.top-E.bottom)}else{const t=p>0?E.top+E.bottom:0;s.scalable=!0,s.height=Math.max(f,y-t),e.height=Math.max(f,R-t)}},calculateListItemMargin=e=>{const t=e.ref.list.childViews[0].childViews[0];return t?{top:t.rect.element.marginTop,bottom:t.rect.element.marginBottom}:{top:0,bottom:0}},calculateListHeight=(e,t)=>{let r=0,o=0;return e.ref.list.childViews[0].childViews.forEach((e,i)=>{if(i>=t)return;const n=e.rect.element,a=n.height+n.marginTop+n.marginBottom;o+=a,r+=e.markedForRemoval?e.opacity*a:a}),{visual:r,bounds:o}},calculateRootBoundingBoxHeight=e=>{const t=e.ref.measureHeight||null;return{cappedHeight:parseInt(e.style.maxHeight,10)||null,fixedHeight:0===t?null:t}},exceedsMaxFiles=(e,t)=>{const r=e.query("GET_ALLOW_REPLACE"),o=e.query("GET_ALLOW_MULTIPLE"),i=e.query("GET_TOTAL_ITEMS");let n=e.query("GET_MAX_FILES");const a=t.length;if(!o&&a>1)return!0;return!!(isInt(n=o?n:r?n:1)&&i+a>n)},toggleAllowDrop=({root:e,props:t,action:r})=>{if(r.value&&!e.ref.hopper){const t=createHopper(e.element,t=>{if(exceedsMaxFiles(e,t))return!1;return!e.query("GET_DROP_VALIDATION")||t.every(t=>applyFilters("ALLOW_HOPPER_ITEM",t,{query:e.query}).every(e=>!0===e))},{catchesDropsOnPage:e.query("GET_DROP_ON_PAGE"),requiresDropOnElement:e.query("GET_DROP_ON_ELEMENT")});t.onload=((t,r)=>{const o=e.ref.list.childViews[0],i=getItemIndexByPosition(o,{left:r.scopeLeft,top:r.scopeTop-e.ref.list.rect.outer.top+e.ref.list.element.scrollTop});forEachDelayed(t,t=>{e.dispatch("ADD_ITEM",{interactionMethod:InteractionMethod.DROP,source:t,index:i})}),e.dispatch("DID_DROP",{position:r}),e.dispatch("DID_END_DRAG",{position:r})}),t.ondragstart=(t=>{e.dispatch("DID_START_DRAG",{position:t})}),t.ondrag=debounce(t=>{e.dispatch("DID_DRAG",{position:t})}),t.ondragend=(t=>{e.dispatch("DID_END_DRAG",{position:t})}),e.ref.hopper=t,e.ref.drip=e.appendChildView(e.createChildView(drip))}else!r.value&&e.ref.hopper&&(e.ref.hopper.destroy(),e.ref.hopper=null,e.removeChildView(e.ref.drip))},toggleAllowBrowse=({root:e,props:t,action:r})=>{r.value?e.ref.browser=e.appendChildView(e.createChildView(browser,Object.assign({},t,{onload:t=>{if(exceedsMaxFiles(e,t))return!1;forEachDelayed(t,t=>{e.dispatch("ADD_ITEM",{interactionMethod:InteractionMethod.BROWSE,source:t,index:0})})}})),0):e.ref.browser&&e.removeChildView(e.ref.browser)},toggleAllowPaste=({root:e,action:t})=>{t.value?(e.ref.paster=createPaster(),e.ref.paster.onload=(t=>{forEachDelayed(t,t=>{e.dispatch("ADD_ITEM",{interactionMethod:InteractionMethod.PASTE,source:t,index:0})})})):e.ref.paster&&(e.ref.paster.destroy(),e.ref.paster=null)},route=createRoute({DID_SET_ALLOW_BROWSE:toggleAllowBrowse,DID_SET_ALLOW_DROP:toggleAllowDrop,DID_SET_ALLOW_PASTE:toggleAllowPaste}),root=createView({name:"root",read:({root:e})=>{e.ref.measure&&(e.ref.measureHeight=e.ref.measure.offsetHeight)},create:create$1,write:write,destroy:({root:e})=>{e.ref.paster&&e.ref.paster.destroy(),e.ref.hopper&&e.ref.hopper.destroy()},mixins:{styles:["height"]}}),createApp$1=(e={})=>{let t=null;const r=getOptions$1(),o=createStore(createInitialState(r),[queries,createOptionQueries(r)],[actions,createOptionActions(r)]);o.dispatch("SET_OPTIONS",{options:e});const i=root(o,{id:getUniqueId()});let n=!1,a=!1;const s={_read:()=>{n||(i._read(),a=i.rect.element.hidden)},_write:e=>{if(a)return;const t=o.processActionQueue().filter(e=>!/^SET_/.test(e.type));n&&!t.length||(p(t),n=i._write(e,t),removeReleasedItems(o.query("GET_ITEMS")),n&&o.processDispatchQueue())}},l=e=>t=>{const r={type:e};if(!t)return r;if(t.hasOwnProperty("error")&&(r.error=t.error?Object.assign({},t.error):null),t.status&&(r.status=Object.assign({},t.status)),t.file&&(r.output=t.file),t.source)r.file=t.source;else if(t.item||t.id){const e=t.item?t.item:o.query("GET_ITEM",t.id);r.file=e?createItemAPI(e):null}return t.items&&(r.items=t.items.map(createItemAPI)),/progress/.test(e)&&(r.progress=t.progress),r},c={DID_DESTROY:l("destroy"),DID_INIT:l("init"),DID_THROW_MAX_FILES:l("warning"),DID_START_ITEM_LOAD:l("addfilestart"),DID_UPDATE_ITEM_LOAD_PROGRESS:l("addfileprogress"),DID_LOAD_ITEM:l("addfile"),DID_THROW_ITEM_INVALID:[l("error"),l("addfile")],DID_THROW_ITEM_LOAD_ERROR:[l("error"),l("addfile")],DID_PREPARE_OUTPUT:l("preparefile"),DID_START_ITEM_PROCESSING:l("processfilestart"),DID_UPDATE_ITEM_PROCESS_PROGRESS:l("processfileprogress"),DID_ABORT_ITEM_PROCESSING:l("processfileabort"),DID_COMPLETE_ITEM_PROCESSING:l("processfile"),DID_REVERT_ITEM_PROCESSING:l("processfilerevert"),DID_THROW_ITEM_PROCESSING_ERROR:[l("error"),l("processfile")],ARCHIVE_ITEM:l("removefile"),DID_UPDATE_ITEMS:l("updatefiles")},p=e=>{e.length&&e.forEach(e=>{if(!c[e.type])return;const t=c[e.type];(Array.isArray(t)?t:[t]).forEach(t=>{setTimeout(()=>{(e=>{const t=Object.assign({pond:g},e);delete t.type,i.element.dispatchEvent(new CustomEvent(`FilePond:${e.type}`,{detail:t,bubbles:!0,cancelable:!0,composed:!0}));const r=[];e.hasOwnProperty("error")&&r.push(e.error),e.hasOwnProperty("file")&&r.push(e.file);const n=["type","error","file"];Object.keys(e).filter(e=>!n.includes(e)).forEach(t=>r.push(e[t])),g.fire(e.type,...r);const a=o.query(`GET_ON${e.type.toUpperCase()}`);a&&a(...r)})(t(e.data))},0)})})},d=(e,t={})=>new Promise((r,i)=>{o.dispatch("ADD_ITEM",{interactionMethod:InteractionMethod.API,source:e,index:t.index,success:r,failure:i,options:t})}),u=e=>(o.dispatch("REMOVE_ITEM",{query:e}),null===o.query("GET_ACTIVE_ITEM",e)),m=()=>o.query("GET_ACTIVE_ITEMS"),E=e=>new Promise((t,r)=>{o.dispatch("PROCESS_ITEM",{query:e,success:e=>{nextTick(()=>{t(e)})},failure:e=>{nextTick(()=>{r(e)})}})}),g=Object.assign({},on(),s,createOptionAPI(o,r),{setOptions:e=>o.dispatch("SET_OPTIONS",{options:e}),addFile:d,addFiles:(...e)=>new Promise((t,r)=>{const o=[],i={};if(isArray(e[0]))o.push(...e[0]),Object.assign(i,e[1]||{});else{const t=e[e.length-1];"object"!=typeof t||t instanceof Blob||Object.assign(i,e.pop()),o.push(...e)}const n=[],a=forEachDelayed(o,e=>{n.push(d(e,i))});Promise.all(a).then(()=>{Promise.all(n).then(e=>{t(e)})})}),getFile:e=>o.query("GET_ACTIVE_ITEM",e),processFile:E,removeFile:u,getFiles:m,processFiles:(...e)=>{const t=Array.isArray(e[0])?e[0]:e;return t.length?Promise.all(t.map(E)):Promise.all(m().map(E))},removeFiles:(...e)=>{const t=Array.isArray(e[0])?e[0]:e,r=m();if(!t.length)return Promise.all(r.map(u));return t.map(e=>isNumber(e)?r[e]?r[e].id:null:e).filter(e=>e).map(u)},browse:()=>{var e=i.element.querySelector("input[type=file]");e&&e.click()},destroy:()=>{g.fire("destroy",i.element),o.dispatch("ABORT_ALL"),i._destroy(),o.dispatch("DID_DESTROY")},insertBefore:e=>insertBefore(i.element,e),insertAfter:e=>insertAfter(i.element,e),appendTo:e=>e.appendChild(i.element),replaceElement:e=>{insertBefore(i.element,e),e.parentNode.removeChild(e),t=e},restoreElement:()=>{t&&(insertAfter(t,i.element),i.element.parentNode.removeChild(i.element),t=null)},isAttachedTo:e=>i.element===e||t===e,element:{get:()=>i.element}});return o.dispatch("DID_INIT"),createObject(g)},createAppObject=(e={})=>{const t={};forin(getOptions$1(),(e,r)=>{t[e]=r[0]});return createApp$1(Object.assign({},t,e))},lowerCaseFirstLetter=e=>e.charAt(0).toLowerCase()+e.slice(1),attributeNameToPropertyName=e=>toCamels(e.replace(/^data-/,"")),mapObject=(e,t)=>{forin(t,(t,r)=>{forin(e,(o,i)=>{const n=new RegExp(t);if(!n.test(o))return;if(delete e[o],!1===r)return;if(isString(r))return void(e[r]=i);const a=r.group;isObject(r)&&!e[a]&&(e[a]={}),e[a][lowerCaseFirstLetter(o.replace(n,""))]=i}),r.mapping&&mapObject(e[r.group],r.mapping)})},getAttributesAsObject=(e,t={})=>{const r=[...e.attributes].reduce((t,r)=>{const o=attr(e,r.name);return t[attributeNameToPropertyName(r.name)]=o===r.name||o,t},{});return mapObject(r,t),r},createAppAtElement=(e,t={})=>{const r={"^class$":"className","^multiple$":"allowMultiple","^capture$":"captureMethod","^server":{group:"server",mapping:{"^process":{group:"process"},"^revert":{group:"revert"},"^fetch":{group:"fetch"},"^restore":{group:"restore"},"^load":{group:"load"}}},"^type$":!1,"^files$":!1};applyFilters("SET_ATTRIBUTE_TO_OPTION_MAP",r);const o=Object.assign({},t),i=getAttributesAsObject("FIELDSET"===e.nodeName?e.querySelector("input[type=file]"):e,r);Object.keys(i).forEach(e=>{isObject(i[e])?(isObject(o[e])||(o[e]={}),Object.assign(o[e],i[e])):o[e]=i[e]}),o.files=(t.files||[]).concat([...e.querySelectorAll("input:not([type=file])")].map(e=>({source:e.value,options:{type:e.dataset.type}})));const n=createAppObject(o);return e.files&&[...e.files].forEach(e=>{n.addFile(e)}),n.replaceElement(e),n},createApp=(...e)=>isNode(e[0])?createAppAtElement(...e):createAppObject(...e),PRIVATE_METHODS$1=["fire","_read","_write"],createAppAPI=e=>{const t={};return copyObjectPropertiesToObject(e,t,PRIVATE_METHODS$1),t},replaceInString=(e,t)=>e.replace(/(?:{([a-zA-Z]+)})/g,(e,r)=>t[r]),images=["jpg","jpeg","png","gif","bmp","webp","svg","tiff"],text$1=["css","csv","html","txt"],map={zip:"zip|compressed",epub:"application/epub+zip"},guesstimateMimeType=(e="")=>(e=e.toLowerCase(),images.includes(e)?"image/"+("jpg"===e?"jpeg":"svg"===e?"svg+xml":e):text$1.includes(e)?"text/"+e:map[e]||null),createWorker=e=>{const t=new Blob(["(",e.toString(),")()"],{type:"application/javascript"}),r=URL.createObjectURL(t),o=new Worker(r);return URL.revokeObjectURL(r),{transfer:(e,t)=>{},post:(e,t,r)=>{const i=getUniqueId();o.onmessage=(e=>{e.data.id===i&&t(e.data.message)}),o.postMessage({id:i,message:e},r)},terminate:()=>{o.terminate()}}},loadImage=e=>new Promise((t,r)=>{const o=new Image;o.onload=(()=>{t(o)}),o.onerror=(e=>{r(e)}),o.src=e}),renameFile=(e,t)=>{const r=e.slice(0,e.size,e.type);return r.lastModifiedDate=e.lastModifiedDate,r.name=t,r},copyFile=e=>renameFile(e,e.name),registeredPlugins=[],createAppPlugin=e=>{if(registeredPlugins.includes(e))return;registeredPlugins.push(e);const t=e({addFilter:addFilter,utils:{Type:Type,forin:forin,isString:isString,isFile:isFile,toNaturalFileSize:toNaturalFileSize,replaceInString:replaceInString,getExtensionFromFilename:getExtensionFromFilename,getFilenameWithoutExtension:getFilenameWithoutExtension,guesstimateMimeType:guesstimateMimeType,getFileFromBlob:getFileFromBlob,getFilenameFromURL:getFilenameFromURL,createRoute:createRoute,createWorker:createWorker,createView:createView,loadImage:loadImage,copyFile:copyFile,renameFile:renameFile,createBlob:createBlob,applyFilterChain:applyFilterChain,text:text,getNumericAspectRatioFromString:getNumericAspectRatioFromString},views:{fileActionButton:fileActionButton}});extendDefaultOptions(t.options)},isOperaMini=()=>"[object OperaMini]"===Object.prototype.toString.call(window.operamini),hasPromises=()=>"Promise"in window,hasBlobSlice=()=>"slice"in Blob.prototype,hasCreateObjectURL=()=>"URL"in window&&"createObjectURL"in window.URL,hasVisibility=()=>"visibilityState"in document,hasTiming=()=>"performance"in window,isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,supported=(()=>{const e=!(isOperaMini()||!isBrowser()||!hasVisibility()||!hasPromises()||!hasBlobSlice()||!hasCreateObjectURL()||!hasTiming());return()=>e})(),state={apps:[]},name="filepond",fn=()=>{};let FileStatus={},OptionTypes={},create=fn,destroy=fn,parse=fn,find=fn,registerPlugin=fn,getOptions=fn,setOptions=fn,FileOrigin={};if(supported()){if(isBrowser){createPainter(createUpdater(state.apps,"_read","_write"),60);const e=()=>{document.dispatchEvent(new CustomEvent("FilePond:loaded",{detail:{supported:supported,create:create,destroy:destroy,parse:parse,find:find,registerPlugin:registerPlugin,setOptions:setOptions}})),document.removeEventListener("DOMContentLoaded",e)};"loading"!==document.readyState?setTimeout(()=>e(),0):document.addEventListener("DOMContentLoaded",e)}const e=()=>forin(getOptions$1(),(e,t)=>{OptionTypes[e]=t[1]});FileOrigin=Object.assign({},FileOrigin$1),FileStatus=Object.assign({},ItemStatus),OptionTypes={},e(),create=((...e)=>{const t=createApp(...e);return t.on("destroy",destroy),state.apps.push(t),createAppAPI(t)}),destroy=(e=>{const t=state.apps.findIndex(t=>t.isAttachedTo(e));if(t>=0){return state.apps.splice(t,1)[0].restoreElement(),!0}return!1}),parse=(e=>{return[...e.querySelectorAll(`.${name}`)].filter(e=>!state.apps.find(t=>t.isAttachedTo(e))).map(e=>create(e))}),find=(e=>{const t=state.apps.find(t=>t.isAttachedTo(e));return t?createAppAPI(t):null}),registerPlugin=((...t)=>{t.forEach(createAppPlugin),e()}),getOptions=(()=>{const e={};return forin(getOptions$1(),(t,r)=>{e[t]=r[0]}),e}),setOptions=(e=>(isObject(e)&&(state.apps.forEach(t=>{t.setOptions(e)}),setOptions$1(e)),getOptions()))}export{supported,FileStatus,OptionTypes,create,destroy,parse,find,registerPlugin,getOptions,setOptions,FileOrigin};